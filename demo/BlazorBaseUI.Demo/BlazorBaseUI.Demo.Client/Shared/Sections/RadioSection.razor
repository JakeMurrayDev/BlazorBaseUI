@using BlazorBaseUI.Radio
@using BlazorBaseUI.RadioGroup
@using BlazorBaseUI.Field
@using BlazorBaseUI.Fieldset
@using BlazorBaseUI.Form

<ComponentShowcase ComponentName="Radio"
                   Description="A control that allows the user to select a single option from a group of options."
                   BaseRoute="/radio"
                   IsWasmMode="IsWasmMode">

<DemoSection Title="Basic Radio Group"
             Description="Select one option from a group. Uses RadioGroup with RadioRoot items.">
    <RadioGroup TValue="string"
                DefaultValue="@("option1")"
                ClassValue="@(state => RadioGroupClass(state))">
        <div class="flex flex-col gap-3">
            <label class="flex cursor-pointer items-center gap-3">
                <RadioRoot TValue="string"
                           Value="@("option1")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Option 1</span>
            </label>

            <label class="flex cursor-pointer items-center gap-3">
                <RadioRoot TValue="string"
                           Value="@("option2")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Option 2</span>
            </label>

            <label class="flex cursor-pointer items-center gap-3">
                <RadioRoot TValue="string"
                           Value="@("option3")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Option 3</span>
            </label>
        </div>
    </RadioGroup>
</DemoSection>

<DemoSection Title="Controlled Radio Group"
             Description="State controlled externally via Value parameter. Updates when changed from outside.">
    <div class="flex flex-col gap-4">
        <RadioGroup TValue="string"
                    Value="@controlledValue"
                    ValueChanged="@(value => controlledValue = value)"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex flex-col gap-3">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("small")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Small</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("medium")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Medium</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("large")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Large</span>
                </label>
            </div>
        </RadioGroup>

        <div class="flex items-center gap-4">
            <span class="text-sm text-gray-700">Selected: <strong>@(controlledValue ?? "none")</strong></span>
            <button type="button"
                    class="rounded bg-indigo-600 px-3 py-1 text-sm text-white hover:bg-indigo-700"
                    @onclick="@(() => controlledValue = "medium")">
                Set to Medium
            </button>
        </div>
    </div>
</DemoSection>

<DemoSection Title="Disabled State"
             Description="Entire group or individual items can be disabled. Uses aria-disabled.">
    <div class="flex flex-col gap-6">
        <div>
            <p class="mb-2 text-sm font-medium text-gray-600">Entire group disabled:</p>
            <RadioGroup TValue="string"
                        DefaultValue="@("a")"
                        Disabled="true"
                        ClassValue="@(state => RadioGroupClass(state))">
                <div class="flex gap-6">
                    <label class="flex cursor-not-allowed items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("a")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-500">Option A</span>
                    </label>

                    <label class="flex cursor-not-allowed items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("b")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-500">Option B</span>
                    </label>
                </div>
            </RadioGroup>
        </div>

        <div>
            <p class="mb-2 text-sm font-medium text-gray-600">Individual item disabled:</p>
            <RadioGroup TValue="string"
                        ClassValue="@(state => RadioGroupClass(state))">
                <div class="flex gap-6">
                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("x")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Option X</span>
                    </label>

                    <label class="flex cursor-not-allowed items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("y")"
                                   Disabled="true"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-500">Option Y (disabled)</span>
                    </label>

                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("z")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Option Z</span>
                    </label>
                </div>
            </RadioGroup>
        </div>
    </div>
</DemoSection>

<DemoSection Title="ReadOnly State"
             Description="Sets aria-readonly attribute. Selection cannot be changed but element remains focusable.">
    <RadioGroup TValue="string"
                DefaultValue="@("readonly-selected")"
                ReadOnly="true"
                ClassValue="@(state => RadioGroupClass(state))">
        <div class="flex gap-6">
            <label class="flex items-center gap-3">
                <RadioRoot TValue="string"
                           Value="@("readonly-selected")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Selected (readonly)</span>
            </label>

            <label class="flex items-center gap-3">
                <RadioRoot TValue="string"
                           Value="@("readonly-other")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Other option</span>
            </label>
        </div>
    </RadioGroup>
</DemoSection>

<DemoSection Title="Horizontal Layout"
             Description="Radio items can be arranged horizontally using flexbox.">
    <RadioGroup TValue="string"
                DefaultValue="@("center")"
                ClassValue="@(state => RadioGroupClass(state))">
        <div class="flex gap-6">
            <label class="flex cursor-pointer items-center gap-2">
                <RadioRoot TValue="string"
                           Value="@("left")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Left</span>
            </label>

            <label class="flex cursor-pointer items-center gap-2">
                <RadioRoot TValue="string"
                           Value="@("center")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Center</span>
            </label>

            <label class="flex cursor-pointer items-center gap-2">
                <RadioRoot TValue="string"
                           Value="@("right")"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-gray-700">Right</span>
            </label>
        </div>
    </RadioGroup>
</DemoSection>

<DemoSection Title="OnValueChange Callback"
             Description="Event handler called when selection changes. Can be canceled.">
    <div class="flex flex-col gap-4">
        <RadioGroup TValue="string"
                    OnValueChange="@HandleValueChange"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("apple")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Apple</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("banana")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Banana</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("cherry")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Cherry</span>
                </label>
            </div>
        </RadioGroup>
        <span class="text-sm text-gray-700">Change count: @changeCount</span>
    </div>

    <div class="mt-6 flex flex-col gap-4">
        <RadioGroup TValue="string"
                    OnValueChange="@HandleCancelableChange"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("one")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">One</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("two")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Two</span>
                </label>
            </div>
        </RadioGroup>
        <label class="flex items-center gap-2">
            <input type="checkbox" @bind="preventChange" class="rounded"/>
            <span class="text-sm text-gray-700">Cancel next change</span>
        </label>
    </div>
</DemoSection>

<DemoSection Title="Keyboard Navigation: Auto-Select on Arrow"
             Description="Arrow keys move focus AND automatically select the focused radio. This matches native radio button behavior.">
    <div class="flex flex-col gap-4">
        <RadioGroup TValue="string"
                    Value="@keyboardAutoSelectValue"
                    ValueChanged="@(v => keyboardAutoSelectValue = v)"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("auto-a")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Option A</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("auto-b")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Option B</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("auto-c")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Option C</span>
                </label>
            </div>
        </RadioGroup>
        <div class="text-sm text-gray-600">
            <strong>Selected:</strong> @(keyboardAutoSelectValue ?? "(none)")
        </div>
        <p class="text-sm text-gray-500">
            1. Click on Option A to focus it<br/>
            2. Press ArrowRight or ArrowDown - focus moves to B <strong>and B becomes selected</strong><br/>
            3. This is the expected behavior per WAI-ARIA radio group pattern
        </p>
    </div>
</DemoSection>

<DemoSection Title="Keyboard Navigation: Focus Looping"
             Description="Navigation loops from last item back to first, and vice versa.">
    <div class="flex flex-col gap-4">
        <RadioGroup TValue="string"
                    Value="@loopingValue"
                    ValueChanged="@(v => loopingValue = v)"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex flex-col gap-3">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("loop-1")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">First Item</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("loop-2")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Second Item</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("loop-3")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Third Item (Last)</span>
                </label>
            </div>
        </RadioGroup>
        <div class="text-sm text-gray-600">
            <strong>Selected:</strong> @(loopingValue ?? "(none)")
        </div>
        <p class="text-sm text-gray-500">
            1. Select "Third Item" and press ArrowDown → loops to "First Item"<br/>
            2. Select "First Item" and press ArrowUp → loops to "Third Item"
        </p>
    </div>
</DemoSection>

<DemoSection Title="Keyboard Navigation: Skip Disabled Items"
             Description="Arrow key navigation automatically skips disabled radio buttons.">
    <div class="flex flex-col gap-4">
        <RadioGroup TValue="string"
                    Value="@skipDisabledValue"
                    ValueChanged="@(v => skipDisabledValue = v)"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex flex-col gap-3">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("skip-1")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Item 1 (enabled)</span>
                </label>

                <label class="flex cursor-not-allowed items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("skip-2")"
                               Disabled="true"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-500">Item 2 (disabled - will be skipped)</span>
                </label>

                <label class="flex cursor-not-allowed items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("skip-3")"
                               Disabled="true"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-500">Item 3 (disabled - will be skipped)</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("skip-4")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Item 4 (enabled)</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("skip-5")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Item 5 (enabled)</span>
                </label>
            </div>
        </RadioGroup>
        <div class="text-sm text-gray-600">
            <strong>Selected:</strong> @(skipDisabledValue ?? "(none)")
        </div>
        <p class="text-sm text-gray-500">
            Select Item 1, then press ArrowDown → jumps directly to Item 4 (skipping disabled Items 2 and 3)
        </p>
    </div>
</DemoSection>

<DemoSection Title="Keyboard Navigation: Roving TabIndex"
             Description="Only the selected (or first enabled) radio has tabindex=0. Tab exits the group entirely.">
    <div class="flex flex-col gap-4">
        <div class="flex items-center gap-4">
            <button type="button"
                    class="rounded border border-gray-300 px-3 py-1 text-sm hover:bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                    @onfocus="@(() => rovingFocusLocation = "Before button")">
                Before (Tab target)
            </button>

            <RadioGroup TValue="string"
                        Value="@rovingTabIndexValue"
                        ValueChanged="@(v =>
                                      {
                                          rovingTabIndexValue = v;
                                          rovingFocusLocation = $"Radio: {v}";
                                      })"
                        ClassValue="@(state => RadioGroupClass(state))">
                <div class="flex gap-4">
                    <label class="flex cursor-pointer items-center gap-2">
                        <RadioRoot TValue="string"
                                   Value="@("roving-a")"
                                   ClassValue="@(state => RadioRootClassWithTabIndex(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">A</span>
                    </label>

                    <label class="flex cursor-pointer items-center gap-2">
                        <RadioRoot TValue="string"
                                   Value="@("roving-b")"
                                   ClassValue="@(state => RadioRootClassWithTabIndex(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">B</span>
                    </label>

                    <label class="flex cursor-pointer items-center gap-2">
                        <RadioRoot TValue="string"
                                   Value="@("roving-c")"
                                   ClassValue="@(state => RadioRootClassWithTabIndex(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">C</span>
                    </label>
                </div>
            </RadioGroup>

            <button type="button"
                    class="rounded border border-gray-300 px-3 py-1 text-sm hover:bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                    @onfocus="@(() => rovingFocusLocation = "After button")">
                After (Tab target)
            </button>
        </div>
        <div class="text-sm text-gray-600">
            <strong>Selected:</strong> @(rovingTabIndexValue ?? "(none)") |
            <strong>Last focus:</strong> @rovingFocusLocation
        </div>
        <p class="text-sm text-gray-500">
            1. No selection: Tab focuses "A" (first enabled), Tab again goes to "After" button<br/>
            2. Select "C" with click, Tab away, then Shift+Tab back → focus returns to "C"<br/>
            3. Only the active radio shows the teal ring (tabindex=0 indicator)
        </p>
    </div>
</DemoSection>

<DemoSection Title="Keyboard Navigation: Modifier Keys (Shift+Arrow)"
             Description="Arrow navigation works even when Shift is held. This allows selection extension patterns.">
    <div class="flex flex-col gap-4">
        <RadioGroup TValue="string"
                    Value="@modifierKeyValue"
                    ValueChanged="@(v => modifierKeyValue = v)"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("mod-1")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">First</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("mod-2")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Second</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("mod-3")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Third</span>
                </label>
            </div>
        </RadioGroup>
        <div class="text-sm text-gray-600">
            <strong>Selected:</strong> @(modifierKeyValue ?? "(none)")
        </div>
        <p class="text-sm text-gray-500">
            Hold Shift and press ArrowRight/ArrowDown - navigation still works.<br/>
            (In React Base UI, RadioGroup sets modifierKeys=[Shift] to allow this)
        </p>
    </div>
</DemoSection>

<DemoSection Title="Field Integration: Fieldset with Legend"
             Description="RadioGroup can be labeled using FieldsetRoot and FieldsetLegend for accessibility.">
    <FieldsetRoot ClassValue="@(_ => "border border-gray-200 rounded-lg p-4")">
        <FieldsetLegend ClassValue="@(_ => "text-lg font-semibold text-gray-900 px-2")">
            Choose your subscription
        </FieldsetLegend>
        <RadioGroup TValue="string"
                    DefaultValue="@("monthly")"
                    ClassValue="@(state => RadioGroupClass(state) + " mt-3")">
            <div class="flex flex-col gap-3">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("monthly")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Monthly - $9.99/mo</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("yearly")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Yearly - $99.99/yr</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("lifetime")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Lifetime - $299.99</span>
                </label>
            </div>
        </RadioGroup>
    </FieldsetRoot>
</DemoSection>

<DemoSection Title="Field Integration: Disabled via Field.Root"
             Description="RadioGroup receives disabled state from Field.Root.">
    <FieldRoot Disabled="true">
        <FieldLabel ClassValue="@(_ => "text-gray-500 font-medium mb-2 block")">
            Disabled via Field.Root
        </FieldLabel>
        <RadioGroup TValue="string"
                    DefaultValue="@("first")"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-not-allowed items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("first")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-500">First</span>
                </label>

                <label class="flex cursor-not-allowed items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("second")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-500">Second</span>
                </label>
            </div>
        </RadioGroup>
    </FieldRoot>
</DemoSection>

<DemoSection Title="Field State Tracking"
             Description="Tracks touched (on blur), dirty (value changed), filled (has selection), and focused states.">
    <FieldRoot Name="tracking">
        <FieldLabel ClassValue="@(_ => "text-gray-700 font-medium mb-2 block")">
            Focus, blur, and select to see state changes
        </FieldLabel>
        <RadioGroup TValue="string"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("track1")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Option 1</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("track2")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Option 2</span>
                </label>
            </div>
        </RadioGroup>
        <FieldStateDisplay Context="fieldState">
            <div class="mt-3 flex gap-4 text-xs">
                <StateIndicator Label="Touched" IsActive="@fieldState.Touched"/>
                <StateIndicator Label="Dirty" IsActive="@fieldState.Dirty"/>
                <StateIndicator Label="Filled" IsActive="@fieldState.Filled"/>
                <StateIndicator Label="Focused" IsActive="@fieldState.Focused"/>
            </div>
        </FieldStateDisplay>
    </FieldRoot>
</DemoSection>

<DemoSection Title="Form Submission"
             Description="RadioGroup submits the selected value. Integrates with Form component.">
    <Form Model="@(new object())" OnFormSubmit="@HandleFormSubmit">
        <FieldRoot Name="plan">
            <FieldLabel ClassValue="@(_ => "text-gray-700 font-medium mb-2 block")">
                Select a plan
            </FieldLabel>
            <RadioGroup TValue="string"
                        DefaultValue="@("basic")"
                        ClassValue="@(state => RadioGroupClass(state))">
                <div class="flex flex-col gap-3">
                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("basic")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Basic</span>
                    </label>

                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("pro")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Pro</span>
                    </label>

                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("enterprise")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Enterprise</span>
                    </label>
                </div>
            </RadioGroup>
        </FieldRoot>
        <button type="submit"
                class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
            Submit
        </button>
    </Form>
    @if (formSubmitResult is not null)
    {
        <div class="mt-4 rounded bg-gray-100 p-3 text-sm">
            <strong>Submitted:</strong> @formSubmitResult
        </div>
    }
</DemoSection>

<DemoSection Title="Required Validation"
             Description="Triggers validation when no option is selected on form submit.">
    <Form Model="@(new object())">
        <FieldRoot Name="required-radio">
            <FieldLabel ClassValue="@(_ => "text-gray-700 font-medium mb-2 block")">
                Select an option *
            </FieldLabel>
            <RadioGroup TValue="string"
                        Required="true"
                        ClassValue="@(state => RadioGroupClass(state))">
                <div class="flex gap-6">
                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("req1")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Option A</span>
                    </label>

                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("req2")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Option B</span>
                    </label>
                </div>
            </RadioGroup>
            <FieldError Match="true"
                        MatchValidity="valueMissing"
                        ClassValue="@(_ => "text-red-600 text-sm mt-2")">
                Please select an option.
            </FieldError>
        </FieldRoot>
        <button type="submit"
                class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
            Submit
        </button>
    </Form>
</DemoSection>

<DemoSection Title="Custom Validation"
             Description="Use Validate function for custom validation logic. Validates on change.">
    <FieldRoot Name="custom-validation"
               ValidationMode="ValidationMode.OnChange"
               Validate="@ValidateSelection">
        <FieldLabel ClassValue="@(_ => "text-gray-700 font-medium mb-2 block")">
            Select "premium" to pass validation
        </FieldLabel>
        <RadioGroup TValue="string"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("free")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Free</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("premium")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Premium</span>
                </label>
            </div>
        </RadioGroup>
        <FieldError ClassValue="@(_ => "text-red-600 text-sm mt-2")"/>
    </FieldRoot>
</DemoSection>

<DemoSection Title="Validation Mode: onBlur"
             Description="Validates when the radio group loses focus.">
    <FieldRoot Name="onBlur-validation"
               ValidationMode="ValidationMode.OnBlur">
        <FieldLabel ClassValue="@(_ => "text-gray-700 font-medium mb-2 block")">
            Required (validates on blur)
        </FieldLabel>
        <RadioGroup TValue="string"
                    Required="true"
                    ClassValue="@(state => RadioGroupClass(state))">
            <div class="flex gap-6">
                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("blur1")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Option 1</span>
                </label>

                <label class="flex cursor-pointer items-center gap-3">
                    <RadioRoot TValue="string"
                               Value="@("blur2")"
                               ClassValue="@(state => RadioRootClass(state))">
                        <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                            <span class="block h-2 w-2 rounded-full bg-white"></span>
                        </RadioIndicator>
                    </RadioRoot>
                    <span class="text-gray-700">Option 2</span>
                </label>
            </div>
        </RadioGroup>
        <FieldError Match="true"
                    MatchValidity="valueMissing"
                    ClassValue="@(_ => "text-red-600 text-sm mt-2")">
            This field is required.
        </FieldError>
    </FieldRoot>
    <p class="mt-2 text-sm text-gray-500">
        Focus the radio group, then blur to trigger validation.
    </p>
</DemoSection>

<DemoSection Title="External Errors"
             Description="Errors set via Form.Errors prop. Cleared on value change.">
    <Form Model="@(new object())" Errors="@externalErrors">
        <FieldRoot Name="external">
            <FieldLabel ClassValue="@(_ => "text-gray-700 font-medium mb-2 block")">
                Has external error (select to clear)
            </FieldLabel>
            <RadioGroup TValue="string"
                        ClassValue="@(state => RadioGroupClass(state))">
                <div class="flex gap-6">
                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("ext1")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Option 1</span>
                    </label>

                    <label class="flex cursor-pointer items-center gap-3">
                        <RadioRoot TValue="string"
                                   Value="@("ext2")"
                                   ClassValue="@(state => RadioRootClass(state))">
                            <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                                <span class="block h-2 w-2 rounded-full bg-white"></span>
                            </RadioIndicator>
                        </RadioRoot>
                        <span class="text-gray-700">Option 2</span>
                    </label>
                </div>
            </RadioGroup>
            <FieldError ClassValue="@(_ => "text-red-600 text-sm mt-2")"/>
        </FieldRoot>
    </Form>
    <button type="button"
            class="mt-3 rounded bg-red-600 px-3 py-1 text-sm text-white hover:bg-red-700"
            @onclick="@SetExternalError">
        Set External Error
    </button>
</DemoSection>

<DemoSection Title="Typed Values"
             Description="RadioGroup supports any type as TValue, not just strings.">
    <RadioGroup TValue="Priority"
                Value="selectedPriority"
                ValueChanged="@(value => selectedPriority = value)"
                ClassValue="@(state => RadioGroupClass(state))">
        <div class="flex gap-6">
            <label class="flex cursor-pointer items-center gap-3">
                <RadioRoot TValue="Priority"
                           Value="Priority.Low"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-green-700">Low</span>
            </label>

            <label class="flex cursor-pointer items-center gap-3">
                <RadioRoot TValue="Priority"
                           Value="Priority.Medium"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-yellow-700">Medium</span>
            </label>

            <label class="flex cursor-pointer items-center gap-3">
                <RadioRoot TValue="Priority"
                           Value="Priority.High"
                           ClassValue="@(state => RadioRootClass(state))">
                    <RadioIndicator ClassValue="@(state => RadioIndicatorClass(state))">
                        <span class="block h-2 w-2 rounded-full bg-white"></span>
                    </RadioIndicator>
                </RadioRoot>
                <span class="text-red-700">High</span>
            </label>
        </div>
    </RadioGroup>
    <div class="mt-3 text-sm text-gray-700">
        Selected priority: <strong>@selectedPriority</strong>
    </div>
</DemoSection>

<DemoSection Title="Card-Style Radio Items"
             Description="Custom styling using ClassValue to create card-style radio buttons.">
    <RadioGroup TValue="string"
                DefaultValue="@("card1")"
                ClassValue="@(state => RadioGroupClass(state))">
        <div class="grid grid-cols-3 gap-4">
            <label class="cursor-pointer">
                <RadioRoot TValue="string"
                           Value="@("card1")"
                           ClassValue="@(state => CardRadioClass(state))">
                    <div class="p-4">
                        <div class="font-semibold text-gray-900">Starter</div>
                        <div class="text-sm text-gray-500">For individuals</div>
                        <div class="mt-2 text-lg font-bold text-indigo-600">$0/mo</div>
                    </div>
                </RadioRoot>
            </label>

            <label class="cursor-pointer">
                <RadioRoot TValue="string"
                           Value="@("card2")"
                           ClassValue="@(state => CardRadioClass(state))">
                    <div class="p-4">
                        <div class="font-semibold text-gray-900">Pro</div>
                        <div class="text-sm text-gray-500">For small teams</div>
                        <div class="mt-2 text-lg font-bold text-indigo-600">$29/mo</div>
                    </div>
                </RadioRoot>
            </label>

            <label class="cursor-pointer">
                <RadioRoot TValue="string"
                           Value="@("card3")"
                           ClassValue="@(state => CardRadioClass(state))">
                    <div class="p-4">
                        <div class="font-semibold text-gray-900">Business</div>
                        <div class="text-sm text-gray-500">For enterprises</div>
                        <div class="mt-2 text-lg font-bold text-indigo-600">$99/mo</div>
                    </div>
                </RadioRoot>
            </label>
        </div>
    </RadioGroup>
</DemoSection>

</ComponentShowcase>

@code {


    [Parameter] public bool IsWasmMode { get; set; }

    private string? controlledValue = "medium";
    private int changeCount;
    private bool preventChange;
    private string? formSubmitResult;
    private Priority selectedPriority = Priority.Medium;
    private Dictionary<string, string[]> externalErrors = new();

    private string? keyboardAutoSelectValue;
    private string? loopingValue;
    private string? skipDisabledValue;
    private string? rovingTabIndexValue;
    private string rovingFocusLocation = "(none)";
    private string? modifierKeyValue;

    public enum Priority
    {
        Low,
        Medium,
        High
    }

    private void HandleValueChange(RadioGroupValueChangeEventArgs<string> e)
    {
        changeCount++;
    }

    private void HandleCancelableChange(RadioGroupValueChangeEventArgs<string> e)
    {
        if (preventChange)
        {
            e.Cancel();
            preventChange = false;
        }
    }

    private void HandleFormSubmit(FormSubmitEventArgs e)
    {
        formSubmitResult = string.Join(", ", e.Values.Select(kv => $"{kv.Key}: {kv.Value}"));
    }

    private Task<string[]?> ValidateSelection(object? value)
    {
        var selected = value as string;
        return Task.FromResult<string[]?>(selected == "premium" ? null : ["Please select 'Premium' option"]);
    }

    private void SetExternalError()
    {
        externalErrors = new Dictionary<string, string[]>
        {
            ["external"] = ["This is an external server error"]
        };
    }

    private static string RadioGroupClass(RadioGroupState state)
    {
        return "outline-none";
    }

    private static string RadioRootClass(RadioRootState state)
    {
        var baseClass = "relative inline-flex h-5 w-5 items-center justify-center rounded-full border-2 transition-all outline-none";

        if (state.Disabled)
            return $"{baseClass} border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed";

        if (state.Valid == false)
            return $"{baseClass} border-red-500 bg-white";

        if (state.Checked)
            return $"{baseClass} border-indigo-600 bg-indigo-600";

        if (state.Focused)
            return $"{baseClass} border-indigo-400 bg-white ring-2 ring-indigo-200";

        return $"{baseClass} border-gray-300 bg-white hover:border-gray-400";
    }

    private static string RadioIndicatorClass(RadioIndicatorState state)
    {
        return "flex items-center justify-center";
    }

    private static string CardRadioClass(RadioRootState state)
    {
        var baseClass = "block rounded-lg border-2 transition-all outline-none";

        if (state.Disabled)
            return $"{baseClass} border-gray-200 bg-gray-50 opacity-50";

        if (state.Checked)
            return $"{baseClass} border-indigo-600 bg-indigo-50 ring-2 ring-indigo-200";

        if (state.Focused)
            return $"{baseClass} border-indigo-400 bg-white ring-2 ring-indigo-100";

        return $"{baseClass} border-gray-200 bg-white hover:border-gray-300";
    }

    private static string RadioRootClassWithTabIndex(RadioRootState state)
    {
        var baseClass = "relative inline-flex h-5 w-5 items-center justify-center rounded-full border-2 transition-all outline-none";

        if (state.Disabled)
            return $"{baseClass} border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed";

        if (state.Valid == false)
            return $"{baseClass} border-red-500 bg-white";

        if (state.Checked)
            return $"{baseClass} border-indigo-600 bg-indigo-600 ring-2 ring-teal-400";

        if (state.Focused)
            return $"{baseClass} border-indigo-400 bg-white ring-2 ring-indigo-200";

        return $"{baseClass} border-gray-300 bg-white hover:border-gray-400";
    }

}
