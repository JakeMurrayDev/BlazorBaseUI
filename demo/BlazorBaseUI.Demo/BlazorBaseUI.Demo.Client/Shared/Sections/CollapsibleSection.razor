@using BlazorBaseUI.Collapsible
@using BlazorBaseUI.Demo.Client.Shared.Icons

<ComponentShowcase ComponentName="Collapsible"
                   Description="An interactive component that shows or hides content."
                   BaseRoute="/collapsible"
                   IsWasmMode="IsWasmMode">

    <DemoSection Title="Basic Usage"
                 Description="An uncontrolled collapsible with smooth height transition."
                 CodeSnippet="@BasicCodeSnippet">
        <CollapsibleRoot ClassValue="@RootClass">
            <CollapsibleTrigger ClassValue="@TriggerClass">
                <span>What is Base UI?</span>
                <ChevronIcon class="size-4 text-gray-500 transition-transform duration-200 ease-out group-data-[panel-open]:rotate-90" />
            </CollapsibleTrigger>
            <CollapsiblePanel ClassValue="@PanelClass">
                <div class="px-4 pb-4 text-sm leading-relaxed text-gray-600">
                    Base UI is a library of high-quality unstyled React components for design systems and web apps. BlazorBaseUI ports these components to Blazor.
                </div>
            </CollapsiblePanel>
        </CollapsibleRoot>
    </DemoSection>

    <DemoSection Title="Default Open"
                 Description="A collapsible that starts in an open state."
                 CodeSnippet="@DefaultOpenCodeSnippet">
        <CollapsibleRoot DefaultOpen="true" ClassValue="@RootClass">
            <CollapsibleTrigger ClassValue="@TriggerClass">
                <span>How do I get started?</span>
                <ChevronIcon class="size-4 text-gray-500 transition-transform duration-200 ease-out group-data-[panel-open]:rotate-90" />
            </CollapsibleTrigger>
            <CollapsiblePanel ClassValue="@PanelClass">
                <div class="px-4 pb-4 text-sm leading-relaxed text-gray-600">
                    Head to the "Quick start" guide in the docs. If you've used unstyled libraries before, you'll feel right at home.
                </div>
            </CollapsiblePanel>
        </CollapsibleRoot>
    </DemoSection>

    <DemoSection Title="Controlled"
                 Description="A collapsible controlled by external state."
                 CodeSnippet="@ControlledCodeSnippet">
        <div class="flex flex-col gap-4">
            <div class="flex items-center gap-3">
                <button class="inline-flex items-center gap-2 rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm transition-colors hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:outline-none"
                        @onclick="@(() => controlledOpen = !controlledOpen)">
                    @(controlledOpen ? "Close" : "Open") Panel
                </button>
                <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">
                    @(controlledOpen ? "Expanded" : "Collapsed")
                </span>
            </div>
            <CollapsibleRoot Open="@controlledOpen"
                             OpenChanged="@(e => controlledOpen = e)"
                             ClassValue="@RootClass">
                <CollapsibleTrigger ClassValue="@TriggerClass">
                    <span>Can I use it for my project?</span>
                    <ChevronIcon class="size-4 text-gray-500 transition-transform duration-200 ease-out group-data-[panel-open]:rotate-90" />
                </CollapsibleTrigger>
                <CollapsiblePanel ClassValue="@PanelClass">
                    <div class="px-4 pb-4 text-sm leading-relaxed text-gray-600">
                        Of course! Base UI is free and open source. Use it in personal projects, commercial apps, or anywhere you need solid accessible components.
                    </div>
                </CollapsiblePanel>
            </CollapsibleRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Disabled"
                 Description="A disabled collapsible that cannot be toggled."
                 CodeSnippet="@DisabledCodeSnippet">
        <CollapsibleRoot Disabled="true" ClassValue="@RootClass">
            <CollapsibleTrigger ClassValue="@DisabledTriggerClass">
                <span>This section is locked</span>
                <ChevronIcon class="size-4 text-gray-300" />
            </CollapsibleTrigger>
            <CollapsiblePanel ClassValue="@PanelClass">
                <div class="px-4 pb-4 text-sm text-gray-400">
                    This content is not accessible.
                </div>
            </CollapsiblePanel>
        </CollapsibleRoot>
    </DemoSection>

    <DemoSection Title="Keep Mounted"
                 Description="Panel stays in DOM when closed (inspect elements to verify)."
                 CodeSnippet="@KeepMountedCodeSnippet">
        <CollapsibleRoot ClassValue="@RootClass">
            <CollapsibleTrigger ClassValue="@TriggerClass">
                <span>Recovery keys</span>
                <ChevronIcon class="size-4 text-gray-500 transition-transform duration-200 ease-out group-data-[panel-open]:rotate-90" />
            </CollapsibleTrigger>
            <CollapsiblePanel KeepMounted ClassValue="@PanelClass">
                <div class="flex flex-col gap-1 px-4 pb-4">
                    <code class="rounded bg-gray-100 px-2 py-1 font-mono text-xs text-gray-700">alien-bean-pasta</code>
                    <code class="rounded bg-gray-100 px-2 py-1 font-mono text-xs text-gray-700">wild-irish-burrito</code>
                    <code class="rounded bg-gray-100 px-2 py-1 font-mono text-xs text-gray-700">horse-battery-staple</code>
                </div>
            </CollapsiblePanel>
        </CollapsibleRoot>
    </DemoSection>

    <DemoSection Title="Event Callback"
                 Description="Track open/close events with OpenChanged."
                 CodeSnippet="@EventCallbackCodeSnippet">
        <div class="flex flex-col gap-4">
            <CollapsibleRoot OpenChanged="@HandleOpenChange" ClassValue="@RootClass">
                <CollapsibleTrigger ClassValue="@TriggerClass">
                    <span>Toggle to fire events</span>
                    <ChevronIcon class="size-4 text-gray-500 transition-transform duration-200 ease-out group-data-[panel-open]:rotate-90" />
                </CollapsibleTrigger>
                <CollapsiblePanel ClassValue="@PanelClass">
                    <div class="px-4 pb-4 text-sm leading-relaxed text-gray-600">
                        Each toggle fires the OpenChanged callback with the new state.
                    </div>
                </CollapsiblePanel>
            </CollapsibleRoot>
            <div class="overflow-hidden rounded-lg border border-gray-200 bg-gray-50">
                <div class="border-b border-gray-200 bg-white px-3 py-2 text-xs font-semibold tracking-wide text-gray-500 uppercase">
                    Event Log
                </div>
                <div class="space-y-1 p-3 font-mono text-xs">
                    <div class="flex justify-between">
                        <span class="text-gray-500">Open:</span>
                        <span class="font-medium text-gray-900">@lastEventOpen</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">Time:</span>
                        <span class="font-medium text-gray-900">@lastEventTime</span>
                    </div>
                </div>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Nested Collapsibles"
                 Description="Collapsibles can be nested within each other."
                 CodeSnippet="@NestedCodeSnippet">
        <CollapsibleRoot DefaultOpen ClassValue="@RootClass">
            <CollapsibleTrigger ClassValue="@TriggerClass">
                <span>Project Settings</span>
                <ChevronIcon class="size-4 text-gray-500 transition-transform duration-200 ease-out group-data-[panel-open]:rotate-90" />
            </CollapsibleTrigger>
            <CollapsiblePanel ClassValue="@PanelClass">
                <div class="flex flex-col gap-3 px-4 pb-4">
                    <div class="text-sm text-gray-600">Configure your project preferences below.</div>
                    <CollapsibleRoot ClassValue="@NestedRootClass">
                        <CollapsibleTrigger ClassValue="@NestedTriggerClass">
                            <span>Advanced Options</span>
                            <ChevronIcon class="size-3.5 text-gray-400 transition-transform duration-200 ease-out group-data-[panel-open]:rotate-90" />
                        </CollapsibleTrigger>
                        <CollapsiblePanel ClassValue="@NestedPanelClass">
                            <div class="space-y-2 px-3 pb-3 text-xs text-gray-500">
                                <div>Enable experimental features</div>
                                <div>Configure build pipeline</div>
                                <div>Set deployment targets</div>
                            </div>
                        </CollapsiblePanel>
                    </CollapsibleRoot>
                </div>
            </CollapsiblePanel>
        </CollapsibleRoot>
    </DemoSection>

</ComponentShowcase>

@code {
    private bool controlledOpen;
    private string lastEventOpen = "-";
    private string lastEventTime = "-";

    [Parameter]
    public bool IsWasmMode { get; set; }

    private void HandleOpenChange(bool e)
    {
        lastEventOpen = e.ToString();
        lastEventTime = DateTime.Now.ToString("HH:mm:ss.fff");
    }

    private Func<CollapsibleRootState, string> RootClass => _ =>
        "w-80 overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm";

    private Func<CollapsibleRootState, string> TriggerClass => _ =>
        "group flex w-full items-center justify-between px-4 py-3 text-left text-sm font-medium text-gray-900 transition-colors hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-indigo-500";

    private Func<CollapsibleRootState, string> DisabledTriggerClass => _ =>
        "group flex w-full cursor-not-allowed items-center justify-between px-4 py-3 text-left text-sm font-medium text-gray-400";

    private Func<CollapsiblePanelState, string> PanelClass => _ =>
        "[&[hidden]:not([hidden='until-found'])]:hidden h-[var(--collapsible-panel-height)] overflow-hidden border-t border-gray-100 bg-gray-50/50 transition-all duration-200 ease-out data-[ending-style]:h-0 data-[starting-style]:h-0";

    private Func<CollapsibleRootState, string> NestedRootClass => _ =>
        "overflow-hidden rounded-md border border-gray-200 bg-white";

    private Func<CollapsibleRootState, string> NestedTriggerClass => _ =>
        "group flex w-full items-center justify-between px-3 py-2 text-left text-xs font-medium text-gray-700 transition-colors hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-indigo-500";

    private Func<CollapsiblePanelState, string> NestedPanelClass => _ =>
        "[&[hidden]:not([hidden='until-found'])]:hidden h-[var(--collapsible-panel-height)] overflow-hidden border-t border-gray-100 bg-gray-50 transition-all duration-200 ease-out data-[ending-style]:h-0 data-[starting-style]:h-0";

    private const string BasicCodeSnippet = @"<CollapsibleRoot>
    <CollapsibleTrigger>
        <span>What is Base UI?</span>
        <ChevronIcon />
    </CollapsibleTrigger>
    <CollapsiblePanel>
        <div>Panel content here...</div>
    </CollapsiblePanel>
</CollapsibleRoot>";

    private const string DefaultOpenCodeSnippet = @"<CollapsibleRoot DefaultOpen=""true"">
    <CollapsibleTrigger>
        <span>How do I get started?</span>
        <ChevronIcon />
    </CollapsibleTrigger>
    <CollapsiblePanel>
        <div>Content...</div>
    </CollapsiblePanel>
</CollapsibleRoot>";

    private const string ControlledCodeSnippet = @"<CollapsibleRoot Open=""@isOpen"" OpenChanged=""@(e => isOpen = e)"">
    <CollapsibleTrigger>
        <span>Can I use it for my project?</span>
        <ChevronIcon />
    </CollapsibleTrigger>
    <CollapsiblePanel>
        <div>Content...</div>
    </CollapsiblePanel>
</CollapsibleRoot>";

    private const string DisabledCodeSnippet = @"<CollapsibleRoot Disabled=""true"">
    <CollapsibleTrigger>
        <span>This section is locked</span>
        <ChevronIcon />
    </CollapsibleTrigger>
    <CollapsiblePanel>
        <div>Cannot access</div>
    </CollapsiblePanel>
</CollapsibleRoot>";

    private const string KeepMountedCodeSnippet = @"<CollapsibleRoot>
    <CollapsibleTrigger>
        <span>Recovery keys</span>
        <ChevronIcon />
    </CollapsibleTrigger>
    <CollapsiblePanel KeepMounted>
        <code>alien-bean-pasta</code>
        <code>wild-irish-burrito</code>
        <code>horse-battery-staple</code>
    </CollapsiblePanel>
</CollapsibleRoot>";

    private const string EventCallbackCodeSnippet = @"<CollapsibleRoot OpenChanged=""@HandleOpenChange"">
    <CollapsibleTrigger>
        <span>Toggle to fire events</span>
        <ChevronIcon />
    </CollapsibleTrigger>
    <CollapsiblePanel>
        <div>Content...</div>
    </CollapsiblePanel>
</CollapsibleRoot>";

    private const string NestedCodeSnippet = @"<CollapsibleRoot DefaultOpen>
    <CollapsibleTrigger>
        <span>Project Settings</span>
        <ChevronIcon />
    </CollapsibleTrigger>
    <CollapsiblePanel>
        <CollapsibleRoot>
            <CollapsibleTrigger>
                <span>Advanced Options</span>
                <ChevronIcon />
            </CollapsibleTrigger>
            <CollapsiblePanel>
                <div>Nested content...</div>
            </CollapsiblePanel>
        </CollapsibleRoot>
    </CollapsiblePanel>
</CollapsibleRoot>";
}