@using BlazorBaseUI.Slider
@using BlazorBaseUI.Field
@using BlazorBaseUI.Form

<ComponentShowcase ComponentName="Slider"
                   Description="A control that allows selecting a value or range from a continuous set of values."
                   BaseRoute="/slider"
                   IsWasmMode="IsWasmMode">

    <DemoSection Title="Basic Slider"
                 Description="Single value slider with uncontrolled state using DefaultValue.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValue="50"
                        ClassValue="@(state => SliderRootClass(state))">
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Controlled Slider"
                 Description="State controlled externally. Value can be changed via slider or input.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot Value="@controlledValue"
                        ValueChanged="@(value => controlledValue = value)"
                        ClassValue="@(state => SliderRootClass(state))">
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
            <div class="flex items-center gap-4">
                <span class="text-sm text-gray-700">Value: @controlledValue.ToString("F0")</span>
                <input type="number"
                       value="@controlledValue"
                       @onchange="@(e => controlledValue = double.TryParse(e.Value?.ToString(), out var v) ? v : controlledValue)"
                       class="w-20 rounded border border-gray-300 px-2 py-1 text-sm" />
                <button type="button"
                        class="rounded bg-indigo-600 px-3 py-1 text-sm text-white transition hover:bg-indigo-700"
                        @onclick="@(() => controlledValue = 75)">
                    Set to 75
                </button>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Slider with Value Display"
                 Description="Shows the current value using SliderValue component with number formatting.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValue="25"
                        Format="@(new NumberFormatOptions(Style: "currency", Currency: "USD"))"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">Price</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Range Slider"
                 Description="Two thumbs for selecting a range of values.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValues="@(new double[] { 25, 75 })"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">Range</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                        <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Controlled Range Slider"
                 Description="Range slider with externally controlled values.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot Values="@controlledRangeValues"
                        ValuesChanged="@(values => controlledRangeValues = values)"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">Range</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                        <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
            <div class="flex items-center gap-4 text-sm text-gray-700">
                <span>Min: @controlledRangeValues[0].ToString("F0")</span>
                <span>Max: @controlledRangeValues[1].ToString("F0")</span>
                <button type="button"
                        class="rounded bg-indigo-600 px-3 py-1 text-sm text-white transition hover:bg-indigo-700"
                        @onclick="@(() => controlledRangeValues = [20, 80])">
                    Reset to 20-80
                </button>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Disabled State"
                 Description="Slider cannot be interacted with when disabled.">
        <div class="w-full max-w-md space-y-6">
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Disabled (single)</span>
                <SliderRoot DefaultValue="40"
                            Disabled="true"
                            ClassValue="@(state => SliderRootClass(state))">
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Disabled (range)</span>
                <SliderRoot DefaultValues="@(new double[] { 30, 70 })"
                            Disabled="true"
                            ClassValue="@(state => SliderRootClass(state))">
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                            <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="ReadOnly State"
                 Description="Slider displays value but cannot be changed.">
        <div class="w-full max-w-md space-y-2">
            <span class="text-sm text-gray-500">ReadOnly</span>
            <SliderRoot DefaultValue="60"
                        ReadOnly="true"
                        ClassValue="@(state => SliderRootClass(state))">
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Vertical Orientation"
                 Description="Slider rendered vertically. Use arrow up/down for navigation.">
        <div class="flex items-start gap-8">
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Single</span>
                <div class="h-48">
                    <SliderRoot DefaultValue="50"
                                Orientation="Orientation.Vertical"
                                ClassValue="@(state => SliderRootClassVertical(state))">
                        <SliderControl ClassValue="@(state => SliderControlClassVertical(state))">
                            <SliderTrack ClassValue="@(state => SliderTrackClassVertical(state))">
                                <SliderIndicator ClassValue="@(state => SliderIndicatorClassVertical(state))" />
                                <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                            </SliderTrack>
                        </SliderControl>
                    </SliderRoot>
                </div>
            </div>
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Range</span>
                <div class="h-48">
                    <SliderRoot DefaultValues="@(new double[] { 25, 75 })"
                                Orientation="Orientation.Vertical"
                                ClassValue="@(state => SliderRootClassVertical(state))">
                        <SliderControl ClassValue="@(state => SliderControlClassVertical(state))">
                            <SliderTrack ClassValue="@(state => SliderTrackClassVertical(state))">
                                <SliderIndicator ClassValue="@(state => SliderIndicatorClassVertical(state))" />
                                <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                                <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                            </SliderTrack>
                        </SliderControl>
                    </SliderRoot>
                </div>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Min, Max, and Step"
                 Description="Configure the slider's range and step increment.">
        <div class="w-full max-w-md space-y-6">
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Min: 0, Max: 10, Step: 1</span>
                <SliderRoot DefaultValue="5"
                            Min="0"
                            Max="10"
                            Step="1"
                            ClassValue="@(state => SliderRootClass(state))">
                    <div class="mb-2 flex items-center justify-between">
                        <span class="text-xs text-gray-500">0</span>
                        <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                        <span class="text-xs text-gray-500">10</span>
                    </div>
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Min: 100, Max: 1000, Step: 50</span>
                <SliderRoot DefaultValue="500"
                            Min="100"
                            Max="1000"
                            Step="50"
                            ClassValue="@(state => SliderRootClass(state))">
                    <div class="mb-2 flex items-center justify-between">
                        <span class="text-xs text-gray-500">100</span>
                        <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                        <span class="text-xs text-gray-500">1000</span>
                    </div>
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Decimal: Min: 0, Max: 1, Step: 0.1</span>
                <SliderRoot DefaultValue="0.5"
                            Min="0"
                            Max="1"
                            Step="0.1"
                            ClassValue="@(state => SliderRootClass(state))">
                    <div class="mb-2 flex items-center justify-between">
                        <span class="text-xs text-gray-500">0</span>
                        <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                        <span class="text-xs text-gray-500">1</span>
                    </div>
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Large Step (Shift + Arrow)"
                 Description="Hold Shift while pressing arrow keys to move by LargeStep amount.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValue="50"
                        Step="1"
                        LargeStep="10"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm text-gray-700">Step: 1, LargeStep: 10</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
            <p class="text-xs text-gray-500">Focus slider and use Arrow keys. Hold Shift for large steps.</p>
        </div>
    </DemoSection>

    <DemoSection Title="MinStepsBetweenValues"
                 Description="Enforces minimum gap between range slider thumbs.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValues="@(new double[] { 40, 60 })"
                        Step="5"
                        MinStepsBetweenValues="2"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm text-gray-700">Min 2 steps (10 units) between thumbs</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                        <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Thumb Collision Behavior"
                 Description="Controls what happens when range slider thumbs meet.">
        <div class="w-full max-w-md space-y-6">
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Push (default) - thumbs push each other</span>
                <SliderRoot DefaultValues="@(new double[] { 40, 60 })"
                            ThumbCollisionBehavior="ThumbCollisionBehavior.Push"
                            ClassValue="@(state => SliderRootClass(state))">
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                            <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
            <div class="space-y-2">
                <span class="text-sm text-gray-500">Swap - thumbs swap positions when crossing</span>
                <SliderRoot DefaultValues="@(new double[] { 40, 60 })"
                            ThumbCollisionBehavior="ThumbCollisionBehavior.Swap"
                            ClassValue="@(state => SliderRootClass(state))">
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                            <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
            <div class="space-y-2">
                <span class="text-sm text-gray-500">None - thumbs cannot pass each other</span>
                <SliderRoot DefaultValues="@(new double[] { 40, 60 })"
                            ThumbCollisionBehavior="ThumbCollisionBehavior.None"
                            ClassValue="@(state => SliderRootClass(state))">
                    <SliderControl ClassValue="@(state => SliderControlClass(state))">
                        <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                            <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                            <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                            <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                        </SliderTrack>
                    </SliderControl>
                </SliderRoot>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="OnValueChange and OnValueCommitted"
                 Description="Callbacks fire during drag (OnValueChange) and on release (OnValueCommitted).">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValue="50"
                        OnValueChange="@HandleValueChange"
                        OnValueCommitted="@HandleValueCommitted"
                        ClassValue="@(state => SliderRootClass(state))">
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
            <div class="space-y-1 text-sm text-gray-700">
                <p>Change count: @valueChangeCount</p>
                <p>Commit count: @valueCommitCount</p>
                <p>Last committed value: @lastCommittedValue?.ToString("F0")</p>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Cancelable OnValueChange"
                 Description="OnValueChange can be canceled to prevent value updates.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValue="50"
                        OnValueChange="@HandleCancelableValueChange"
                        ClassValue="@(state => SliderRootClass(state))">
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
            <label class="flex items-center gap-2">
                <input type="checkbox" @bind="preventValueChange" class="rounded" />
                <span class="text-sm text-gray-700">Prevent values above 75</span>
            </label>
        </div>
    </DemoSection>

    <DemoSection Title="Field Integration"
                 Description="Slider integrates with FieldRoot for labels and descriptions.">
        <div class="w-full max-w-md space-y-6">
            <FieldRoot Name="volume">
                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-700")">
                            Volume
                        </FieldLabel>
                    </div>
                    <SliderRoot DefaultValue="70"
                                ClassValue="@(state => SliderRootClass(state))">
                        <SliderControl ClassValue="@(state => SliderControlClass(state))">
                            <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                            </SliderTrack>
                        </SliderControl>
                    </SliderRoot>
                    <FieldDescription ClassValue="@(_ => "text-xs text-gray-500")">
                        Adjust the audio volume level.
                    </FieldDescription>
                </div>
            </FieldRoot>

            <FieldRoot Name="brightness" Disabled="true">
                <div class="space-y-2">
                    <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-500")">
                        Brightness (Disabled via Field)
                    </FieldLabel>
                    <SliderRoot DefaultValue="50"
                                ClassValue="@(state => SliderRootClass(state))">
                        <SliderControl ClassValue="@(state => SliderControlClass(state))">
                            <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                            </SliderTrack>
                        </SliderControl>
                    </SliderRoot>
                </div>
            </FieldRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Field State Tracking"
                 Description="Tracks touched, dirty, filled, and focused states.">
        <div class="w-full max-w-md">
            <FieldRoot Name="tracking">
                <div class="space-y-2">
                    <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-700")">
                        Track my state
                    </FieldLabel>
                    <SliderRoot DefaultValue="0"
                                ClassValue="@(state => SliderRootClassWithStates(state))">
                        <SliderControl ClassValue="@(state => SliderControlClass(state))">
                            <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                <SliderThumb ClassValue="@(state => SliderThumbClassWithStates(state))" />
                            </SliderTrack>
                        </SliderControl>
                    </SliderRoot>
                </div>
                <FieldStateDisplay Context="fieldState">
                    <div class="mt-3 space-y-1 text-xs">
                        <div class="flex gap-4">
                            <StateIndicator Label="Touched" IsActive="@fieldState.Touched" />
                            <StateIndicator Label="Dirty" IsActive="@fieldState.Dirty" />
                            <StateIndicator Label="Filled" IsActive="@fieldState.Filled" />
                            <StateIndicator Label="Focused" IsActive="@fieldState.Focused" />
                        </div>
                    </div>
                </FieldStateDisplay>
            </FieldRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Form Submission"
                 Description="Slider values are included in form submission data.">
        <div class="w-full max-w-md">
            <Form Model="@formModel" OnFormSubmit="@HandleFormSubmit">
                <div class="space-y-6">
                    <FieldRoot Name="rating">
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-700")">
                                    Rating
                                </FieldLabel>
                            </div>
                            <SliderRoot DefaultValue="3"
                                        Min="1"
                                        Max="5"
                                        Step="1"
                                        ClassValue="@(state => SliderRootClass(state))">
                                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                                    </SliderTrack>
                                </SliderControl>
                            </SliderRoot>
                        </div>
                    </FieldRoot>

                    <FieldRoot Name="priceRange">
                        <div class="space-y-2">
                            <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-700")">
                                Price Range
                            </FieldLabel>
                            <SliderRoot DefaultValues="@(new double[] { 100, 500 })"
                                        Min="0"
                                        Max="1000"
                                        Step="50"
                                        ClassValue="@(state => SliderRootClass(state))">
                                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                        <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                                        <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                                    </SliderTrack>
                                </SliderControl>
                            </SliderRoot>
                        </div>
                    </FieldRoot>

                    <button type="submit"
                            class="rounded bg-indigo-600 px-4 py-2 text-white transition hover:bg-indigo-700">
                        Submit
                    </button>
                </div>
            </Form>

            @if (lastFormSubmission is not null)
            {
                <div class="mt-4 rounded bg-gray-100 p-3 text-sm">
                    <strong>Last submission:</strong>
                    <pre class="mt-1 text-xs">@lastFormSubmission</pre>
                </div>
            }
        </div>
    </DemoSection>

    <DemoSection Title="Validation"
                 Description="Supports required validation and custom validate function.">
        <div class="w-full max-w-md space-y-6">
            <Form Model="@(new object())">
                <FieldRoot Name="required"
                           ValidationMode="ValidationMode.OnChange"
                           Validate="@ValidateMinValue">
                    <div class="space-y-2">
                        <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-700")">
                            Must be at least 25
                        </FieldLabel>
                        <SliderRoot DefaultValue="10"
                                    ClassValue="@(state => SliderRootClass(state))">
                            <SliderControl ClassValue="@(state => SliderControlClass(state))">
                                <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                    <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                    <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                                </SliderTrack>
                            </SliderControl>
                        </SliderRoot>
                        <FieldError ClassValue="@(_ => "text-red-600 text-sm")" />
                    </div>
                </FieldRoot>
            </Form>

            <Form Model="@(new object())">
                <FieldRoot Name="range"
                           ValidationMode="ValidationMode.OnChange"
                           Validate="@ValidateRangeSpan">
                    <div class="space-y-2">
                        <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-700")">
                            Range must span at least 30 units
                        </FieldLabel>
                        <SliderRoot DefaultValues="@(new double[] { 40, 60 })"
                                    ClassValue="@(state => SliderRootClass(state))">
                            <SliderControl ClassValue="@(state => SliderControlClass(state))">
                                <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                    <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                    <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                                    <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                                </SliderTrack>
                            </SliderControl>
                        </SliderRoot>
                        <FieldError ClassValue="@(_ => "text-red-600 text-sm")" />
                    </div>
                </FieldRoot>
            </Form>
        </div>
    </DemoSection>

    <DemoSection Title="External Errors"
                 Description="Errors can be set externally via Form. Cleared on change.">
        <div class="w-full max-w-md">
            <Form Model="@(new object())" Errors="@externalErrors">
                <FieldRoot Name="external">
                    <div class="space-y-2">
                        <FieldLabel ClassValue="@(_ => "text-sm font-medium text-gray-700")">
                            Has external error (change to clear)
                        </FieldLabel>
                        <SliderRoot DefaultValue="50"
                                    ClassValue="@(state => SliderRootClass(state))">
                            <SliderControl ClassValue="@(state => SliderControlClass(state))">
                                <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                                    <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                                    <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                                </SliderTrack>
                            </SliderControl>
                        </SliderRoot>
                        <FieldError ClassValue="@(_ => "text-red-600 text-sm")" />
                    </div>
                </FieldRoot>
            </Form>

            <button type="button"
                    class="mt-3 rounded bg-red-600 px-3 py-1 text-sm text-white transition hover:bg-red-700"
                    @onclick="@SetExternalError">
                Set External Error
            </button>
        </div>
    </DemoSection>

    <DemoSection Title="Custom Value Render"
                 Description="SliderValue accepts a render function for custom formatting.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValues="@(new double[] { 20, 80 })"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">Custom Format</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")">
                        <span>From @context.Values[0].ToString("F0")% to @context.Values[1].ToString("F0")%</span>
                    </SliderValue>
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb Index="0" ClassValue="@(state => SliderThumbClass(state))" />
                        <SliderThumb Index="1" ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Keyboard Navigation"
                 Description="Focus with Tab. Use Arrow keys, Home, End, PageUp, PageDown.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValue="50"
                        Step="5"
                        LargeStep="20"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">Keyboard Demo</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
            <div class="space-y-1 text-xs text-gray-500">
                <p>Arrow Left/Right/Up/Down: Move by step (5)</p>
                <p>Shift + Arrow: Move by large step (20)</p>
                <p>Home: Go to minimum</p>
                <p>End: Go to maximum</p>
                <p>PageUp/PageDown: Move by large step</p>
            </div>
            @if (!IsWasmMode)
            {
                <p class="text-xs text-amber-600">(Server mode may have slight latency)</p>
            }
        </div>
    </DemoSection>

    <DemoSection Title="ARIA Labels"
                 Description="Custom aria-label and aria-valuetext for accessibility.">
        <div class="w-full max-w-md space-y-4">
            <SliderRoot DefaultValues="@(new double[] { 20, 80 })"
                        ClassValue="@(state => SliderRootClass(state))">
                <div class="mb-2 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">Price Filter</span>
                    <SliderValue ClassValue="@(state => "text-sm font-semibold text-indigo-600")" />
                </div>
                <SliderControl ClassValue="@(state => SliderControlClass(state))">
                    <SliderTrack ClassValue="@(state => SliderTrackClass(state))">
                        <SliderIndicator ClassValue="@(state => SliderIndicatorClass(state))" />
                        <SliderThumb Index="0"
                                     GetAriaLabel="@(index => "Minimum price")"
                                     GetAriaValueText="@((formatted, value, index) => $"${value:F0}")"
                                     ClassValue="@(state => SliderThumbClass(state))" />
                        <SliderThumb Index="1"
                                     GetAriaLabel="@(index => "Maximum price")"
                                     GetAriaValueText="@((formatted, value, index) => $"${value:F0}")"
                                     ClassValue="@(state => SliderThumbClass(state))" />
                    </SliderTrack>
                </SliderControl>
            </SliderRoot>
        </div>
    </DemoSection>

</ComponentShowcase>

@code {
    [Parameter]
    public bool IsWasmMode { get; set; }

    private double controlledValue = 50;
    private double[] controlledRangeValues = [25, 75];
    private int valueChangeCount;
    private int valueCommitCount;
    private double? lastCommittedValue;
    private bool preventValueChange;
    private object formModel = new();
    private string? lastFormSubmission;
    private Dictionary<string, string[]> externalErrors = new();

    private void HandleValueChange(SliderValueChangeEventArgs<double> e)
    {
        valueChangeCount++;
    }

    private void HandleValueCommitted(SliderValueCommittedEventArgs<double> e)
    {
        valueCommitCount++;
        lastCommittedValue = e.Value;
    }

    private void HandleCancelableValueChange(SliderValueChangeEventArgs<double> e)
    {
        if (preventValueChange && e.Value > 75)
        {
            e.Cancel();
        }
    }

    private void HandleFormSubmit(FormSubmitEventArgs e)
    {
        lastFormSubmission = string.Join("\n", e.Values.Select(kv => $"{kv.Key}: {kv.Value}"));
    }

    private Task<string[]?> ValidateMinValue(object? value)
    {
        if (value is double v && v < 25)
        {
            return Task.FromResult<string[]?>(["Value must be at least 25"]);
        }
        return Task.FromResult<string[]?>(null);
    }

    private Task<string[]?> ValidateRangeSpan(object? value)
    {
        if (value is double[] values && values.Length >= 2)
        {
            var span = values[^1] - values[0];
            if (span < 30)
            {
                return Task.FromResult<string[]?>(["Range must span at least 30 units"]);
            }
        }
        return Task.FromResult<string[]?>(null);
    }

    private void SetExternalError()
    {
        externalErrors = new Dictionary<string, string[]>
        {
            ["external"] = ["This is an external server error"]
        };
    }

    private static string SliderRootClass(SliderRootState state)
    {
        var baseClass = "relative w-full";
        if (state.Disabled) return $"{baseClass} opacity-50 cursor-not-allowed";
        return baseClass;
    }

    private static string SliderRootClassVertical(SliderRootState state)
    {
        var baseClass = "relative h-full";
        if (state.Disabled) return $"{baseClass} opacity-50 cursor-not-allowed";
        return baseClass;
    }

    private static string SliderRootClassWithStates(SliderRootState state)
    {
        var baseClass = SliderRootClass(state);
        if (state.Valid == false) baseClass += " ring-2 ring-red-500 rounded";
        return baseClass;
    }

    private static string SliderControlClass(SliderRootState state)
    {
        var baseClass = "relative flex items-center h-5 cursor-pointer";
        if (state.Disabled || state.ReadOnly) return $"{baseClass} cursor-default";
        return baseClass;
    }

    private static string SliderControlClassVertical(SliderRootState state)
    {
        var baseClass = "relative flex flex-col items-center w-5 h-full cursor-pointer";
        if (state.Disabled || state.ReadOnly) return $"{baseClass} cursor-default";
        return baseClass;
    }

    private static string SliderTrackClass(SliderRootState state)
    {
        var baseClass = "relative h-1.5 w-full rounded-full";
        if (state.Disabled) return $"{baseClass} bg-gray-200";
        return $"{baseClass} bg-gray-200";
    }

    private static string SliderTrackClassVertical(SliderRootState state)
    {
        var baseClass = "relative w-1.5 h-full rounded-full";
        if (state.Disabled) return $"{baseClass} bg-gray-200";
        return $"{baseClass} bg-gray-200";
    }

    private static string SliderIndicatorClass(SliderRootState state)
    {
        var baseClass = "rounded-full";
        if (state.Disabled) return $"{baseClass} bg-gray-400";
        if (state.Valid == false) return $"{baseClass} bg-red-500";
        return $"{baseClass} bg-indigo-600";
    }

    private static string SliderIndicatorClassVertical(SliderRootState state)
    {
        var baseClass = "rounded-full";
        if (state.Disabled) return $"{baseClass} bg-gray-400";
        if (state.Valid == false) return $"{baseClass} bg-red-500";
        return $"{baseClass} bg-indigo-600";
    }

    private static string SliderThumbClass(SliderThumbState state)
    {
        var baseClass = "block h-4 w-4 rounded-full border-2 shadow-sm focus-within:ring-2 focus-within:ring-indigo-400 focus-within:ring-offset-2";
        if (state.Disabled) return $"{baseClass} border-gray-400 bg-gray-100";
        if (state.Valid == false) return $"{baseClass} border-red-500 bg-white";
        if (state.Dragging) return $"{baseClass} border-indigo-700 bg-indigo-100 scale-110";
        return $"{baseClass} border-indigo-600 bg-white hover:bg-indigo-50";
    }

    private static string SliderThumbClassWithStates(SliderThumbState state)
    {
        var baseClass = SliderThumbClass(state);
        if (state.Focused) baseClass += " ring-2 ring-blue-400";
        return baseClass;
    }
}
