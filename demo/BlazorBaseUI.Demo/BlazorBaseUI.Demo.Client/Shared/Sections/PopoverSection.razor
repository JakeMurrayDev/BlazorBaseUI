@using BlazorBaseUI.Popover

<ComponentShowcase ComponentName="Popover"
                   Description="A popup that appears relative to a trigger element, commonly used for displaying contextual information or actions."
                   BaseRoute="/popover"
                   IsWasmMode="IsWasmMode">

    <DemoSection Title="Basic Click Trigger"
                 Description="Click the trigger button to open the popover. Click again to close it.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Open Popover
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <p>This is popover content!</p>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Notifications Example"
                 Description="A styled notifications popover example from the base-ui documentation.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => NotificationTriggerClass(state))">
                <svg fill="currentColor" width="20" height="20" viewBox="0 0 16 16" aria-label="Notifications">
                    <path d="M 8 1 C 7.453125 1 7 1.453125 7 2 L 7 3.140625 C 5.28125 3.589844 4 5.144531 4 7 L 4 10.984375 C 4 10.984375 3.984375 11.261719 3.851563 11.519531 C 3.71875 11.78125 3.558594 12 3 12 L 3 13 L 13 13 L 13 12 C 12.40625 12 12.253906 11.78125 12.128906 11.53125 C 12.003906 11.277344 12 11.003906 12 11.003906 L 12 7 C 12 5.144531 10.71875 3.589844 9 3.140625 L 9 2 C 9 1.453125 8.546875 1 8 1 Z M 8 13 C 7.449219 13 7 13.449219 7 14 C 7 14.550781 7.449219 15 8 15 C 8.550781 15 9 14.550781 9 14 C 9 13.449219 8.550781 13 8 13 Z M 8 4 C 9.664063 4 11 5.335938 11 7 L 11 10.996094 C 11 10.996094 10.988281 11.472656 11.234375 11.96875 C 11.238281 11.980469 11.246094 11.988281 11.25 12 L 4.726563 12 C 4.730469 11.992188 4.738281 11.984375 4.742188 11.980469 C 4.992188 11.488281 5 11.015625 5 11.015625 L 5 7 C 5 5.335938 6.335938 4 8 4 Z" />
                </svg>
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner SideOffset="8">
                    <PopoverPopup ClassValue="@(state => NotificationPopupClass(state))">
                        <PopoverArrow ClassValue="@(state => NotificationArrowClass(state))">
                            <svg width="20" height="10" viewBox="0 0 20 10" fill="none">
                                <path d="M9.66437 2.60207L4.80758 6.97318C4.07308 7.63423 3.11989 8 2.13172 8H0V10H20V8H18.5349C17.5468 8 16.5936 7.63423 15.8591 6.97318L11.0023 2.60207C10.622 2.2598 10.0447 2.25979 9.66437 2.60207Z" class="fill-[canvas]" />
                                <path d="M8.99542 1.85876C9.75604 1.17425 10.9106 1.17422 11.6713 1.85878L16.5281 6.22989C17.0789 6.72568 17.7938 7.00001 18.5349 7.00001L15.89 7L11.0023 2.60207C10.622 2.2598 10.0447 2.2598 9.66436 2.60207L4.77734 7L2.13171 7.00001C2.87284 7.00001 3.58774 6.72568 4.13861 6.22989L8.99542 1.85876Z" class="fill-gray-200 dark:fill-none" />
                                <path d="M10.3333 3.34539L5.47654 7.71648C4.55842 8.54279 3.36693 9 2.13172 9H0V8H2.13172C3.11989 8 4.07308 7.63423 4.80758 6.97318L9.66437 2.60207C10.0447 2.25979 10.622 2.2598 11.0023 2.60207L15.8591 6.97318C16.5936 7.63423 17.5468 8 18.5349 8H20V9H18.5349C17.2998 9 16.1083 8.54278 15.1901 7.71648L10.3333 3.34539Z" class="dark:fill-gray-300" />
                            </svg>
                        </PopoverArrow>
                        <PopoverTitle class="text-base font-medium">Notifications</PopoverTitle>
                        <PopoverDescription class="text-base text-gray-600">
                            You are all caught up. Good job!
                        </PopoverDescription>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Controlled Open State"
                 Description="The open state can be controlled externally with callbacks on open/close.">
        <div class="flex flex-col gap-4">
            <PopoverRoot Open="@controlledOpen"
                         OnOpenChange="HandleOpenChange">
                <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                    @(controlledOpen ? "Close" : "Open") Popover
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverPositioner>
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>Controlled popover content</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>
            <div class="text-sm text-gray-600">
                <p>Open: <strong>@controlledOpen</strong></p>
                <p>Last reason: <strong>@(lastReason?.ToString() ?? "None")</strong></p>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Default Open"
                 Description="The popover can be rendered in an initially open state using DefaultOpen.">
        <PopoverRoot DefaultOpen="true">
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Toggle (Default Open)
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <p>This popover started open!</p>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Hover Trigger"
                 Description="Open the popover on hover with configurable delay and close delay.">
        <div class="flex gap-4">
            <PopoverRoot>
                <PopoverTrigger OpenOnHover="true"
                                Delay="0"
                                CloseDelay="0"
                                ClassValue="@(state => TriggerClass(state))">
                    Hover (No Delay)
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverPositioner>
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>Opens immediately on hover</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>

            <PopoverRoot>
                <PopoverTrigger OpenOnHover="true"
                                Delay="300"
                                CloseDelay="200"
                                ClassValue="@(state => TriggerClass(state))">
                    Hover (300ms/200ms)
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverPositioner>
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>Opens after 300ms, closes after 200ms</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Disabled Trigger"
                 Description="A disabled trigger prevents the popover from opening.">
        <div class="flex gap-4">
            <PopoverRoot>
                <PopoverTrigger Disabled="true"
                                ClassValue="@(state => TriggerClass(state))">
                    Disabled Button
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverPositioner>
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>You should not see this!</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>

            <PopoverRoot>
                <PopoverTrigger Disabled="true"
                                NativeButton="false"
                                As="span"
                                ClassValue="@(state => TriggerClass(state))">
                    Disabled Span (aria-disabled)
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverPositioner>
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>You should not see this!</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>
        </div>
        <div class="mt-3 rounded bg-gray-100 p-3 font-mono text-xs">
            <p>The first button uses native <code>disabled</code> attribute.</p>
            <p>The second uses <code>aria-disabled="true"</code> for non-button elements.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Positioning: Side"
                 Description="The popover can be positioned on different sides of the trigger.">
        <div class="flex flex-wrap items-center justify-center gap-4">
            @foreach (var side in new[] { Side.Top, Side.Right, Side.Bottom, Side.Left })
            {
                <PopoverRoot>
                    <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                        @side
                    </PopoverTrigger>
                    <PopoverPortal>
                        <PopoverPositioner Side="@side">
                            <PopoverPopup ClassValue="@(state => PopupClass(state))">
                                <p>Side: @side</p>
                            </PopoverPopup>
                        </PopoverPositioner>
                    </PopoverPortal>
                </PopoverRoot>
            }
        </div>
    </DemoSection>

    <DemoSection Title="Positioning: Align"
                 Description="Within a side, the popover can be aligned to start, center, or end.">
        <div class="flex flex-wrap items-center justify-center gap-4">
            @foreach (var align in new[] { Align.Start, Align.Center, Align.End })
            {
                <PopoverRoot>
                    <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                        @align
                    </PopoverTrigger>
                    <PopoverPortal>
                        <PopoverPositioner Side="Side.Bottom" Align="@align">
                            <PopoverPopup ClassValue="@(state => PopupClass(state))">
                                <p>Align: @align</p>
                            </PopoverPopup>
                        </PopoverPositioner>
                    </PopoverPortal>
                </PopoverRoot>
            }
        </div>
    </DemoSection>

    <DemoSection Title="Side and Align Offset"
                 Description="Offset the popover from its default position using SideOffset and AlignOffset.">
        <div class="flex flex-wrap items-center justify-center gap-4">
            <PopoverRoot>
                <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                    SideOffset: 20
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverPositioner SideOffset="20">
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>20px from trigger</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>

            <PopoverRoot>
                <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                    AlignOffset: 30
                </PopoverTrigger>
                <PopoverPortal>
                    <PopoverPositioner AlignOffset="30" Align="Align.Start">
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>30px align offset</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>
        </div>
    </DemoSection>

    <DemoSection Title="With Close Button"
                 Description="PopoverClose provides a button that closes the popover when clicked.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Open Popover
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <div class="flex items-start justify-between gap-4">
                            <p>Click the X to close</p>
                            <PopoverClose class="rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600">
                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </PopoverClose>
                        </div>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Title and Description"
                 Description="PopoverTitle and PopoverDescription provide accessible labeling via aria-labelledby and aria-describedby.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Open Details
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <PopoverTitle class="text-lg font-semibold text-gray-900">
                            Popover Title
                        </PopoverTitle>
                        <PopoverDescription class="mt-2 text-sm text-gray-600">
                            This is a description that provides more context about the popover content.
                            It will be read by screen readers.
                        </PopoverDescription>
                        <div class="mt-4 flex justify-end">
                            <PopoverClose class="rounded bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700">
                                Got it
                            </PopoverClose>
                        </div>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="With Arrow"
                 Description="PopoverArrow renders an arrow pointing to the trigger element.">
        <div class="flex gap-4">
            @foreach (var side in new[] { Side.Top, Side.Right, Side.Bottom, Side.Left })
            {
                <PopoverRoot>
                    <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                        @side
                    </PopoverTrigger>
                    <PopoverPortal>
                        <PopoverPositioner Side="@side" SideOffset="8">
                            <PopoverPopup ClassValue="@(state => PopupClass(state))">
                                <PopoverArrow ClassValue="@(state => ArrowClass(state))">
                                    <svg width="20" height="10" viewBox="0 0 20 10" fill="none">
                                        <path d="M9.66437 2.60207L4.80758 6.97318C4.07308 7.63423 3.11989 8 2.13172 8H0V10H20V8H18.5349C17.5468 8 16.5936 7.63423 15.8591 6.97318L11.0023 2.60207C10.622 2.2598 10.0447 2.25979 9.66437 2.60207Z" class="fill-white" />
                                        <path d="M8.99542 1.85876C9.75604 1.17425 10.9106 1.17422 11.6713 1.85878L16.5281 6.22989C17.0789 6.72568 17.7938 7.00001 18.5349 7.00001L15.89 7L11.0023 2.60207C10.622 2.2598 10.0447 2.2598 9.66436 2.60207L4.77553 7L2.13171 7.00001C2.87284 7.00001 3.58774 6.72568 4.13861 6.22989L8.99542 1.85876Z" class="fill-gray-200" />
                                    </svg>
                                </PopoverArrow>
                                <p>Arrow pointing to trigger</p>
                            </PopoverPopup>
                        </PopoverPositioner>
                    </PopoverPortal>
                </PopoverRoot>
            }
        </div>
    </DemoSection>

    <DemoSection Title="Modal Mode"
                 Description="When modal is true, an internal backdrop is rendered and focus is trapped within the popover.">
        <PopoverRoot Modal="ModalMode.True">
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Open Modal Popover
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <PopoverTitle class="text-lg font-semibold text-gray-900">
                            Modal Popover
                        </PopoverTitle>
                        <PopoverDescription class="mt-2 text-sm text-gray-600">
                            This popover has a backdrop. Click outside or press Escape to close.
                        </PopoverDescription>
                        <div class="mt-4 flex justify-end">
                            <PopoverClose class="rounded bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700">
                                Close
                            </PopoverClose>
                        </div>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="With Backdrop"
                 Description="PopoverBackdrop renders a custom backdrop element behind the popover.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Open with Backdrop
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverBackdrop ClassValue="@(state => BackdropClass(state))" />
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <p>This popover has a visible backdrop</p>
                        <PopoverClose class="mt-3 rounded bg-gray-200 px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-300">
                            Close
                        </PopoverClose>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Keep Mounted"
                 Description="When KeepMounted is true, the popover remains in the DOM when closed (hidden).">
        <div class="flex flex-col gap-4">
            <PopoverRoot>
                <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                    Keep Mounted Popover
                </PopoverTrigger>
                <PopoverPortal KeepMounted="true">
                    <PopoverPositioner>
                        <PopoverPopup ClassValue="@(state => PopupClass(state))">
                            <p>This popover stays in the DOM when closed</p>
                        </PopoverPopup>
                    </PopoverPositioner>
                </PopoverPortal>
            </PopoverRoot>
            <div class="rounded bg-gray-100 p-3 text-sm text-gray-700">
                <p>With <code>KeepMounted="true"</code>, the popover element remains in the DOM but is hidden.</p>
                <p class="mt-1">This is useful for preserving state or improving performance when frequently toggling.</p>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Escape to Close"
                 Description="Press Escape key while the popover is open to close it.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Open and Press Escape
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <p>Press <kbd class="rounded bg-gray-200 px-1.5 py-0.5 font-mono text-xs">Escape</kbd> to close</p>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Outside Click to Close"
                 Description="Clicking outside the popover will close it (when not in modal mode).">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Click Outside to Close
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner>
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <p>Click anywhere outside this popover to close it</p>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Data Attributes"
                 Description="The popover components expose data attributes for styling based on state.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                Check Data Attributes
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner Side="Side.Bottom" Align="Align.Start">
                    <PopoverPopup ClassValue="@(state => PopupClass(state))">
                        <p class="font-medium">Available data attributes:</p>
                        <ul class="mt-2 list-inside list-disc text-sm text-gray-600">
                            <li><code>data-open</code> / <code>data-closed</code></li>
                            <li><code>data-side="bottom"</code></li>
                            <li><code>data-align="start"</code></li>
                            <li><code>data-starting-style</code> (during open transition)</li>
                            <li><code>data-ending-style</code> (during close transition)</li>
                        </ul>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

    <DemoSection Title="Handle (Detached Triggers)"
                 Description="Use a handle to connect triggers placed outside the PopoverRoot for shared popover content.">
        <div class="flex flex-col gap-4">
            <div class="flex gap-4">
                <PopoverTypedTrigger TPayload="string"
                                Handle="@detachedPopoverHandle"
                                Id="product-1"
                                Payload="@("Laptop - $999")"
                                ClassValue="@(state => TriggerClass(state))">
                    Laptop
                </PopoverTypedTrigger>
                <PopoverTypedTrigger TPayload="string"
                                Handle="@detachedPopoverHandle"
                                Id="product-2"
                                Payload="@("Phone - $599")"
                                ClassValue="@(state => TriggerClass(state))">
                    Phone
                </PopoverTypedTrigger>
                <PopoverTypedTrigger TPayload="string"
                                Handle="@detachedPopoverHandle"
                                Id="product-3"
                                Payload="@("Tablet - $449")"
                                ClassValue="@(state => TriggerClass(state))">
                    Tablet
                </PopoverTypedTrigger>
            </div>

            <PopoverRoot Handle="@detachedPopoverHandle">
                <ChildContentWithPayload>
                    @{
                        var handlePayloadContext = context;
                    }
                    <PopoverPortal>
                        <PopoverPositioner SideOffset="8">
                            <PopoverPopup ClassValue="@(state => PopupClass(state))">
                                <PopoverTitle class="text-base font-medium">Product Details</PopoverTitle>
                                <PopoverDescription class="text-sm text-gray-600">
                                    @(handlePayloadContext.Payload?.ToString() ?? "Click a product to see details")
                                </PopoverDescription>
                                <PopoverClose class="mt-3 rounded bg-gray-200 px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-300">
                                    Close
                                </PopoverClose>
                            </PopoverPopup>
                        </PopoverPositioner>
                    </PopoverPortal>
                </ChildContentWithPayload>
            </PopoverRoot>

            <div class="flex gap-2">
                <button class="rounded bg-blue-500 px-3 py-1.5 text-sm text-white hover:bg-blue-600"
                        @onclick="@(() => detachedPopoverHandle.Open("product-1"))">
                    Open Laptop
                </button>
                <button class="rounded bg-gray-200 px-3 py-1.5 text-sm hover:bg-gray-300"
                        @onclick="@(() => detachedPopoverHandle.Close())">
                    Close
                </button>
            </div>
        </div>
        <div class="mt-3 rounded bg-gray-100 p-3 text-sm text-gray-700">
            <p>Triggers are placed <strong>outside</strong> the PopoverRoot but share a common handle.</p>
            <p class="mt-1">The handle also allows imperative control via <code>Open(triggerId)</code> and <code>Close()</code>.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Typed Payload with Handle"
                 Description="Use generics for type-safe payloads with complex data objects.">
        <div class="flex flex-col gap-4">
            <div class="flex gap-4">
                @foreach (var item in sampleItems)
                {
                    <PopoverTypedTrigger TPayload="ItemInfo"
                                    Handle="@typedPopoverHandle"
                                    Id="@($"item-{item.Id}")"
                                    Payload="@item"
                                    ClassValue="@(state => TriggerClass(state))">
                        @item.Name
                    </PopoverTypedTrigger>
                }
            </div>

            <PopoverRoot Handle="@typedPopoverHandle">
                <ChildContentWithPayload>
                    @{
                        var typedPayloadContext = context;
                        var itemInfo = typedPayloadContext.Payload as ItemInfo;
                    }
                    <PopoverPortal>
                        <PopoverPositioner SideOffset="8">
                            <PopoverPopup ClassValue="@(state => PopupClass(state))" StyleValue="@(_ => "min-width: 220px;")">
                                @if (itemInfo is not null)
                                {
                                    <PopoverTitle class="text-base font-medium">@itemInfo.Name</PopoverTitle>
                                    <div class="mt-2 space-y-1 text-sm">
                                        <p class="text-gray-600">@itemInfo.Description</p>
                                        <p class="font-medium text-green-600">@itemInfo.Price.ToString("C")</p>
                                        <p class="text-xs text-gray-500">
                                            @(itemInfo.InStock ? "In Stock" : "Out of Stock")
                                        </p>
                                    </div>
                                }
                                else
                                {
                                    <p class="text-sm text-gray-600">Click a product to see details</p>
                                }
                                <PopoverClose class="mt-3 w-full rounded bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700">
                                    Close
                                </PopoverClose>
                            </PopoverPopup>
                        </PopoverPositioner>
                    </PopoverPortal>
                </ChildContentWithPayload>
            </PopoverRoot>
        </div>
        <div class="mt-3 rounded bg-gray-100 p-3 text-sm text-gray-700">
            <p>Using <code>PopoverTypedTrigger&lt;ItemInfo&gt;</code> and <code>PopoverHandle&lt;ItemInfo&gt;</code> provides compile-time type safety.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Complete Example"
                 Description="A comprehensive example combining multiple features.">
        <PopoverRoot>
            <PopoverTrigger ClassValue="@(state => TriggerClass(state))">
                <span class="flex items-center gap-2">
                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
                    </svg>
                    Help
                </span>
            </PopoverTrigger>
            <PopoverPortal>
                <PopoverPositioner Side="Side.Bottom" Align="Align.End" SideOffset="8">
                    <PopoverPopup ClassValue="@(state => PopupClass(state))" StyleValue="@(_ => "width: 320px;")">
                        <div class="flex items-start justify-between">
                            <PopoverTitle class="text-lg font-semibold text-gray-900">
                                Need Help?
                            </PopoverTitle>
                            <PopoverClose class="rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600">
                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </PopoverClose>
                        </div>
                        <PopoverDescription class="mt-2 text-sm text-gray-600">
                            Our support team is here to help you with any questions or issues you may have.
                        </PopoverDescription>
                        <div class="mt-4 space-y-2">
                            <a href="#" class="flex items-center gap-2 rounded-lg p-2 text-sm text-gray-700 hover:bg-gray-100">
                                <svg class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                                </svg>
                                Documentation
                            </a>
                            <a href="#" class="flex items-center gap-2 rounded-lg p-2 text-sm text-gray-700 hover:bg-gray-100">
                                <svg class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
                                </svg>
                                Contact Support
                            </a>
                        </div>
                    </PopoverPopup>
                </PopoverPositioner>
            </PopoverPortal>
        </PopoverRoot>
    </DemoSection>

</ComponentShowcase>

@code {
    [Parameter]
    public bool IsWasmMode { get; set; }

    private bool controlledOpen;
    private OpenChangeReason? lastReason;

    // Handle for detached triggers demo (string payload)
    private readonly PopoverHandle<string> detachedPopoverHandle = new();

    // Handle for typed payload demo
    private readonly PopoverHandle<ItemInfo> typedPopoverHandle = new();

    // Sample data for typed payload demo
    private readonly List<ItemInfo> sampleItems =
    [
        new ItemInfo(1, "Laptop", "High-performance laptop for professionals", 999.99m, true),
        new ItemInfo(2, "Phone", "Latest smartphone with advanced features", 599.99m, true),
        new ItemInfo(3, "Tablet", "Versatile tablet for work and play", 449.99m, false)
    ];

    private record ItemInfo(int Id, string Name, string Description, decimal Price, bool InStock);

    private Task HandleOpenChange(PopoverOpenChangeEventArgs e)
    {
        controlledOpen = e.Open;
        lastReason = e.Reason;
        return Task.CompletedTask;
    }

    private static string TriggerClass(PopoverTriggerState state)
    {
        var baseClass = "inline-flex items-center justify-center rounded-lg px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 focus-visible:ring-offset-2";

        if (state.Disabled)
            return $"{baseClass} bg-gray-100 text-gray-400 cursor-not-allowed";

        return $"{baseClass} bg-indigo-600 text-white hover:bg-indigo-700 active:bg-indigo-800";
    }

    private static string PopupClass(PopoverPopupState state)
    {
        return "rounded-lg border border-gray-200 bg-white p-4 shadow-lg";
    }

    private static string ArrowClass(PopoverArrowState state)
    {
        // Position is handled by JS, just need to ensure proper display
        return "";
    }

    private static string BackdropClass(PopoverBackdropState state)
    {
        return "fixed inset-0 bg-black/20";
    }

    private static string NotificationTriggerClass(PopoverTriggerState state)
    {
        var baseClass = "flex h-10 w-10 items-center justify-center rounded-full border border-gray-200 bg-gray-50 text-gray-700 select-none hover:bg-gray-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-800 active:bg-gray-200";
        return state.Open ? $"{baseClass} bg-gray-200" : baseClass;
    }

    private static string NotificationPopupClass(PopoverPopupState state)
    {
        var baseClass = "origin-[var(--transform-origin)] rounded-lg bg-[canvas] p-4 text-gray-900 shadow-lg shadow-gray-200 outline outline-gray-200 transition-all duration-200";

        if (state.TransitionStatus == TransitionStatus.Starting)
        {
            return $"{baseClass} scale-95 opacity-0";
        }

        if (state.TransitionStatus == TransitionStatus.Ending)
        {
            return $"{baseClass} scale-95 opacity-0";
        }

        return $"{baseClass} scale-100 opacity-100";
    }

    private static string NotificationArrowClass(PopoverArrowState state)
    {
        return "data-[side=bottom]:top-[-10px] data-[side=left]:right-[-10px] data-[side=left]:rotate-90 data-[side=right]:left-[-10px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-10px] data-[side=top]:rotate-180";
    }
}
