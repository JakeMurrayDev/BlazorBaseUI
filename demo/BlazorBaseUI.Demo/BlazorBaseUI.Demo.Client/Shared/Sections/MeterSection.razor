@using BlazorBaseUI.Meter

<ComponentShowcase ComponentName="Meter"
                   Description="A meter that displays a value within a known range."
                   BaseRoute="/meter"
                   IsWasmMode="IsWasmMode">
    <DemoSection Title="Basic Usage"
                 Description="A meter showing a value with label, value display, and indicator.">
        <div class="flex flex-col gap-8 w-80">
            <MeterRoot Value="value"
                       ClassValue="@(state => "flex flex-col gap-2")">
                <div class="flex justify-between text-sm text-gray-700">
                    <MeterLabel>Disk Usage</MeterLabel>
                    <MeterValue />
                </div>
                <MeterTrack class="relative h-2 w-full overflow-hidden rounded-full bg-gray-200">
                    <MeterIndicator class="h-full bg-blue-600 rounded-full transition-all duration-300" />
                </MeterTrack>
            </MeterRoot>

            <div class="flex gap-2">
                <button type="button"
                        class="rounded bg-blue-600 px-3 py-1.5 text-sm text-white hover:bg-blue-700"
                        @onclick="DecreaseValue">
                    -10%
                </button>
                <button type="button"
                        class="rounded bg-blue-600 px-3 py-1.5 text-sm text-white hover:bg-blue-700"
                        @onclick="IncreaseValue">
                    +10%
                </button>
                <button type="button"
                        class="rounded bg-gray-600 px-3 py-1.5 text-sm text-white hover:bg-gray-700"
                        @onclick="ResetValue">
                    Reset
                </button>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Custom Value Display"
                 Description="Meter with custom value rendering using ChildContent callback.">
        <div class="w-80">
            <MeterRoot Value="customValue"
                       ClassValue="@(state => "flex flex-col gap-2")">
                <div class="flex justify-between text-sm text-gray-700">
                    <MeterLabel>Storage</MeterLabel>
                    <MeterValue ChildContent="@CustomValueRenderer" />
                </div>
                <MeterTrack class="relative h-3 w-full overflow-hidden rounded-full bg-gray-200">
                    <MeterIndicator class="h-full bg-blue-600 rounded-full transition-all duration-300" />
                </MeterTrack>
            </MeterRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Custom Formatting"
                 Description="Meter with custom number formatting using Format parameter.">
        <div class="w-80">
            <MeterRoot Value="86.49"
                       Format="F1"
                       ClassValue="@(state => "flex flex-col gap-2")">
                <div class="flex justify-between text-sm text-gray-700">
                    <MeterLabel>CPU Usage</MeterLabel>
                    <MeterValue />
                </div>
                <MeterTrack class="relative h-2 w-full overflow-hidden rounded-full bg-gray-200">
                    <MeterIndicator class="h-full bg-purple-600 rounded-full transition-all duration-300" />
                </MeterTrack>
            </MeterRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Locale Formatting"
                 Description="Meter with locale-specific formatting using FormatProvider.">
        <div class="w-80">
            <MeterRoot Value="86.49"
                       Format="F2"
                       FormatProvider="germanCulture"
                       ClassValue="@(state => "flex flex-col gap-2")">
                <div class="flex justify-between text-sm text-gray-700">
                    <MeterLabel>Speichernutzung</MeterLabel>
                    <MeterValue />
                </div>
                <MeterTrack class="relative h-2 w-full overflow-hidden rounded-full bg-gray-200">
                    <MeterIndicator class="h-full bg-amber-600 rounded-full transition-all duration-300" />
                </MeterTrack>
            </MeterRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Dynamic Value Update"
                 Description="Meter that updates its value dynamically with button controls.">
        <div class="flex flex-col gap-8 w-80">
            <MeterRoot Value="dynamicValue"
                       ClassValue="@(state => "flex flex-col gap-2")">
                <div class="flex justify-between text-sm text-gray-700">
                    <MeterLabel>Battery Level</MeterLabel>
                    <MeterValue />
                </div>
                <MeterTrack class="relative h-4 w-full overflow-hidden rounded-full bg-gray-200">
                    <MeterIndicator ClassValue="@(_ => GetBatteryIndicatorClass())" />
                </MeterTrack>
            </MeterRoot>

            <div class="flex gap-2">
                <button type="button"
                        class="rounded bg-red-600 px-3 py-1.5 text-sm text-white hover:bg-red-700"
                        @onclick="() => dynamicValue = Math.Max(0, dynamicValue - 10)">
                    Drain -10%
                </button>
                <button type="button"
                        class="rounded bg-green-600 px-3 py-1.5 text-sm text-white hover:bg-green-700"
                        @onclick="() => dynamicValue = Math.Min(100, dynamicValue + 10)">
                    Charge +10%
                </button>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Label Association"
                 Description="Meter with aria-labelledby linking and GetAriaValueText callback.">
        <div class="w-80">
            <MeterRoot Value="72"
                       GetAriaValueText="@((formatted, val) => $"{val} out of 100 gigabytes used")"
                       ClassValue="@(state => "flex flex-col gap-2")">
                <div class="flex justify-between text-sm text-gray-700">
                    <MeterLabel>Server Storage</MeterLabel>
                    <MeterValue ChildContent="@((formatted, val) => b => b.AddContent(0, $"{val} GB / 100 GB"))" />
                </div>
                <MeterTrack class="relative h-2 w-full overflow-hidden rounded-full bg-gray-200">
                    <MeterIndicator class="h-full bg-teal-600 rounded-full transition-all duration-300" />
                </MeterTrack>
            </MeterRoot>
        </div>
    </DemoSection>
</ComponentShowcase>

@code {
    private static readonly System.Globalization.CultureInfo germanCulture =
        System.Globalization.CultureInfo.GetCultureInfo("de-DE");

    private double value = 45;
    private double customValue = 64;
    private double dynamicValue = 75;

    [Parameter]
    public bool IsWasmMode { get; set; }

    private void IncreaseValue()
    {
        value = Math.Min(100, value + 10);
    }

    private void DecreaseValue()
    {
        value = Math.Max(0, value - 10);
    }

    private void ResetValue()
    {
        value = 0;
    }

    private RenderFragment CustomValueRenderer(string formattedValue, double val)
    {
        return builder =>
        {
            builder.OpenElement(0, "span");
            builder.AddAttribute(1, "class", "font-mono font-semibold");
            builder.AddContent(2, $"{val:F0} / 100 GB");
            builder.CloseElement();
        };
    }

    private string GetBatteryIndicatorClass()
    {
        return dynamicValue switch
        {
            <= 20 => "h-full bg-red-600 rounded-full transition-all duration-300",
            <= 50 => "h-full bg-amber-500 rounded-full transition-all duration-300",
            _ => "h-full bg-green-600 rounded-full transition-all duration-300"
        };
    }
}
