@using BlazorBaseUI.Tooltip
@using BlazorBaseUI.Popover

<ComponentShowcase ComponentName="Tooltip"
                   Description="A popup that displays information related to an element when the element receives keyboard focus or the mouse hovers over it."
                   BaseRoute="/tooltip"
                   IsWasmMode="IsWasmMode">

    <DemoSection Title="Basic Hover Tooltip"
                 Description="Hover over the trigger to show the tooltip after a 600ms delay.">
        <TooltipRoot>
            <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                Hover me
            </TooltipTrigger>
            <TooltipPortal>
                <TooltipPositioner SideOffset="8">
                    <TooltipPopup ClassValue="@(state => PopupClass(state))">
                        <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                            @ArrowSvg
                        </TooltipArrow>
                        This is a tooltip
                    </TooltipPopup>
                </TooltipPositioner>
            </TooltipPortal>
        </TooltipRoot>
    </DemoSection>

    <DemoSection Title="Focus Tooltip"
                 Description="Tab to the trigger element to show the tooltip instantly on keyboard focus.">
        <TooltipRoot>
            <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                Tab to focus me
            </TooltipTrigger>
            <TooltipPortal>
                <TooltipPositioner SideOffset="8">
                    <TooltipPopup ClassValue="@(state => PopupClass(state))">
                        <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                            @ArrowSvg
                        </TooltipArrow>
                        Tooltip shown on focus
                    </TooltipPopup>
                </TooltipPositioner>
            </TooltipPortal>
        </TooltipRoot>
    </DemoSection>

    <DemoSection Title="Custom Delays"
                 Description="Configure open and close delay timings for the tooltip.">
        <div class="flex gap-4">
            <TooltipRoot>
                <TooltipTrigger TPayload="object"
                                Delay="0"
                                CloseDelay="0"
                                ClassValue="@(state => TriggerClass(state))">
                    No Delay
                </TooltipTrigger>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                @ArrowSvg
                            </TooltipArrow>
                            Opens immediately
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>

            <TooltipRoot>
                <TooltipTrigger TPayload="object"
                                Delay="200"
                                CloseDelay="100"
                                ClassValue="@(state => TriggerClass(state))">
                    200ms / 100ms
                </TooltipTrigger>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                @ArrowSvg
                            </TooltipArrow>
                            Custom delay timing
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>

            <TooltipRoot>
                <TooltipTrigger TPayload="object"
                                Delay="1000"
                                CloseDelay="500"
                                ClassValue="@(state => TriggerClass(state))">
                    1s / 500ms
                </TooltipTrigger>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                @ArrowSvg
                            </TooltipArrow>
                            Long delay tooltip
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Provider Delay Group"
                 Description="Tooltips within a provider share delay timing. Move quickly between tooltips to see instant opening.">
        <TooltipProvider Timeout="400">
            <div class="flex gap-2">
                @for (var i = 1; i <= 4; i++)
                {
                    var index = i;
                    <TooltipRoot>
                        <TooltipTrigger TPayload="object"
                                        Delay="600"
                                        ClassValue="@(state => TriggerClass(state))">
                            Tooltip @index
                        </TooltipTrigger>
                        <TooltipPortal>
                            <TooltipPositioner SideOffset="8">
                                <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                    <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                        @ArrowSvg
                                    </TooltipArrow>
                                    Content @index
                                </TooltipPopup>
                            </TooltipPositioner>
                        </TooltipPortal>
                    </TooltipRoot>
                }
            </div>
        </TooltipProvider>
        <div class="mt-3 rounded bg-gray-100 p-3 text-sm text-gray-700">
            <p>After hovering the first tooltip, quickly move to another.</p>
            <p class="mt-1">Within 400ms timeout, subsequent tooltips open instantly.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Positioning: Side"
                 Description="Position the tooltip on different sides of the trigger.">
        <div class="flex flex-wrap items-center justify-center gap-4">
            @foreach (var side in new[] { Side.Top, Side.Right, Side.Bottom, Side.Left })
            {
                <TooltipRoot>
                    <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                        @side
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner Side="@side" SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                Side: @side
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>
            }
        </div>
    </DemoSection>

    <DemoSection Title="Positioning: Align"
                 Description="Within a side, align the tooltip to start, center, or end.">
        <div class="flex flex-wrap items-center justify-center gap-4">
            @foreach (var align in new[] { Align.Start, Align.Center, Align.End })
            {
                <TooltipRoot>
                    <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                        @align
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner Side="Side.Bottom" Align="@align" SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                Align: @align
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>
            }
        </div>
    </DemoSection>

    <DemoSection Title="With Arrow"
                 Description="TooltipArrow renders an arrow pointing to the trigger element.">
        <div class="flex gap-4">
            @foreach (var side in new[] { Side.Top, Side.Right, Side.Bottom, Side.Left })
            {
                <TooltipRoot>
                    <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                        @side
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner Side="@side" SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                Arrow pointing to trigger
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>
            }
        </div>
    </DemoSection>

    <DemoSection Title="Disabled Trigger"
                 Description="A disabled trigger prevents the tooltip from showing.">
        <div class="flex gap-4">
            <TooltipRoot>
                <TooltipTrigger TPayload="object"
                                Disabled="true"
                                ClassValue="@(state => TriggerClass(state))">
                    Disabled Button
                </TooltipTrigger>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            You should not see this
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>

            <TooltipRoot Disabled="true">
                <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                    Root Disabled
                </TooltipTrigger>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            You should not see this
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>
        </div>
        <div class="mt-3 rounded bg-gray-100 p-3 text-sm text-gray-700">
            <p>Tooltips can be disabled at the trigger or root level.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Controlled State"
                 Description="The open state can be controlled externally with callbacks on open/close.">
        <div class="flex flex-col gap-4">
            <div class="flex gap-4">
                <TooltipRoot Open="@controlledOpen"
                             OnOpenChange="HandleOpenChange">
                    <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                        Controlled Tooltip
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                Controlled tooltip content
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>

                <button class="rounded bg-gray-200 px-3 py-2 text-sm hover:bg-gray-300"
                        @onclick="@(() => controlledOpen = !controlledOpen)">
                    Toggle: @(controlledOpen ? "Close" : "Open")
                </button>
            </div>
            <div class="text-sm text-gray-600">
                <p>Open: <strong>@controlledOpen</strong></p>
                <p>Last reason: <strong>@(lastReason?.ToString() ?? "None")</strong></p>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Default Open"
                 Description="The tooltip can be rendered in an initially open state using DefaultOpen.">
        <TooltipRoot DefaultOpen="true">
            <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                Default Open
            </TooltipTrigger>
            <TooltipPortal>
                <TooltipPositioner SideOffset="8">
                    <TooltipPopup ClassValue="@(state => PopupClass(state))">
                        <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                            @ArrowSvg
                        </TooltipArrow>
                        This tooltip started open
                    </TooltipPopup>
                </TooltipPositioner>
            </TooltipPortal>
        </TooltipRoot>
    </DemoSection>

    <DemoSection Title="Escape to Close"
                 Description="Press Escape key while the tooltip is open to close it.">
        <TooltipRoot>
            <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                Open and Press Escape
            </TooltipTrigger>
            <TooltipPortal>
                <TooltipPositioner SideOffset="8">
                    <TooltipPopup ClassValue="@(state => PopupClass(state))">
                        <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                            @ArrowSvg
                        </TooltipArrow>
                        Press <kbd class="rounded bg-gray-200 px-1.5 py-0.5 font-mono text-xs text-gray-800">Escape</kbd> to close
                    </TooltipPopup>
                </TooltipPositioner>
            </TooltipPortal>
        </TooltipRoot>
    </DemoSection>

    <DemoSection Title="Hoverable Popup"
                 Description="By default, tooltips close when moving to the popup. Enable hoverable popup to allow interaction.">
        <div class="flex gap-4">
            <TooltipRoot>
                <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                    Default (Not Hoverable)
                </TooltipTrigger>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                @ArrowSvg
                            </TooltipArrow>
                            Closes when you move to this
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>

            <TooltipRoot DisableHoverablePopup="false">
                <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                    Hoverable Popup
                </TooltipTrigger>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                @ArrowSvg
                            </TooltipArrow>
                            You can hover over this popup
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>
        </div>
    </DemoSection>

    <DemoSection Title="Keep Mounted"
                 Description="When KeepMounted is true, the tooltip remains in the DOM when closed (hidden).">
        <div class="flex flex-col gap-4">
            <TooltipRoot>
                <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                    Keep Mounted Tooltip
                </TooltipTrigger>
                <TooltipPortal KeepMounted="true">
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                @ArrowSvg
                            </TooltipArrow>
                            This tooltip stays in the DOM
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </TooltipRoot>
            <div class="rounded bg-gray-100 p-3 text-sm text-gray-700">
                <p>With <code>KeepMounted="true"</code>, the tooltip element remains in the DOM but is hidden.</p>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Data Attributes"
                 Description="The tooltip components expose data attributes for styling based on state.">
        <TooltipRoot>
            <TooltipTrigger TPayload="object" ClassValue="@(state => TriggerClass(state))">
                Check Data Attributes
            </TooltipTrigger>
            <TooltipPortal>
                <TooltipPositioner Side="Side.Bottom" Align="Align.Start" SideOffset="8">
                    <TooltipPopup ClassValue="@(state => PopupClass(state))" StyleValue="@(_ => "max-width: 280px;")">
                        <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                            @ArrowSvg
                        </TooltipArrow>
                        <p class="font-medium text-gray-900">Available data attributes:</p>
                        <ul class="mt-2 list-inside list-disc text-sm text-gray-600">
                            <li><code class="text-xs">data-open</code> / <code class="text-xs">data-closed</code></li>
                            <li><code class="text-xs">data-side="bottom"</code></li>
                            <li><code class="text-xs">data-align="start"</code></li>
                            <li><code class="text-xs">data-instant="delay|focus|dismiss"</code></li>
                            <li><code class="text-xs">data-starting-style</code></li>
                            <li><code class="text-xs">data-ending-style</code></li>
                        </ul>
                    </TooltipPopup>
                </TooltipPositioner>
            </TooltipPortal>
        </TooltipRoot>
    </DemoSection>

    <DemoSection Title="Toolbar Example"
                 Description="Multiple tooltips in a toolbar group with instant switching within the provider.">
        <TooltipProvider Timeout="400">
            <div class="inline-flex rounded-lg border border-gray-200 bg-white p-1 shadow-sm">
                <TooltipRoot>
                    <TooltipTrigger TPayload="object"
                                    As="button"
                                    class="rounded p-2 text-gray-600 hover:bg-gray-100 hover:text-gray-900 focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 focus:outline-none">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 00-1.883 2.542l.857 6a2.25 2.25 0 002.227 1.932H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-1.883-2.542m-16.5 0V6A2.25 2.25 0 016 3.75h3.879a1.5 1.5 0 011.06.44l2.122 2.12a1.5 1.5 0 001.06.44H18A2.25 2.25 0 0120.25 9v.776" />
                        </svg>
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                New Folder
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>

                <TooltipRoot>
                    <TooltipTrigger TPayload="object"
                                    As="button"
                                    class="rounded p-2 text-gray-600 hover:bg-gray-100 hover:text-gray-900 focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 focus:outline-none">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                        </svg>
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                New File
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>

                <div class="mx-1 w-px bg-gray-200"></div>

                <TooltipRoot>
                    <TooltipTrigger TPayload="object"
                                    As="button"
                                    class="rounded p-2 text-gray-600 hover:bg-gray-100 hover:text-gray-900 focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 focus:outline-none">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9.75a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
                        </svg>
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                Copy
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>

                <TooltipRoot>
                    <TooltipTrigger TPayload="object"
                                    As="button"
                                    class="rounded p-2 text-gray-600 hover:bg-gray-100 hover:text-gray-900 focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 focus:outline-none">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                    </TooltipTrigger>
                    <TooltipPortal>
                        <TooltipPositioner SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                Delete
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </TooltipRoot>
            </div>
        </TooltipProvider>
    </DemoSection>

    <DemoSection Title="Payload"
                 Description="Pass data from triggers to the tooltip content using the Payload parameter.">
        <TooltipRoot>
            <ChildContentWithPayload>
                @{
                    var payloadContext = context;
                }
                <div class="flex gap-4">
                    <TooltipTrigger TPayload="object"
                                    Id="user-1"
                                    Payload="@("Alice - Online")"
                                    ClassValue="@(state => TriggerClass(state))">
                        Alice
                    </TooltipTrigger>
                    <TooltipTrigger TPayload="object"
                                    Id="user-2"
                                    Payload="@("Bob - Away")"
                                    ClassValue="@(state => TriggerClass(state))">
                        Bob
                    </TooltipTrigger>
                    <TooltipTrigger TPayload="object"
                                    Id="user-3"
                                    Payload="@("Charlie - Offline")"
                                    ClassValue="@(state => TriggerClass(state))">
                        Charlie
                    </TooltipTrigger>
                </div>
                <TooltipPortal>
                    <TooltipPositioner SideOffset="8">
                        <TooltipPopup ClassValue="@(state => PopupClass(state))">
                            <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                @ArrowSvg
                            </TooltipArrow>
                            @(payloadContext.Payload?.ToString() ?? "No payload")
                        </TooltipPopup>
                    </TooltipPositioner>
                </TooltipPortal>
            </ChildContentWithPayload>
        </TooltipRoot>
        <div class="mt-3 rounded bg-gray-100 p-3 text-sm text-gray-700">
            <p>Each trigger passes its own payload. The tooltip displays the payload from the active trigger.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Handle (Detached Triggers)"
                 Description="Use a handle to connect triggers placed outside the TooltipRoot.">
        <div class="flex flex-col gap-4">
            <div class="flex gap-4">
                <TooltipTrigger TPayload="object"
                                Handle="@detachedHandle"
                                Id="detached-1"
                                Payload="@("Product A - $99")"
                                ClassValue="@(state => TriggerClass(state))">
                    Product A
                </TooltipTrigger>
                <TooltipTrigger TPayload="object"
                                Handle="@detachedHandle"
                                Id="detached-2"
                                Payload="@("Product B - $149")"
                                ClassValue="@(state => TriggerClass(state))">
                    Product B
                </TooltipTrigger>
                <TooltipTrigger TPayload="object"
                                Handle="@detachedHandle"
                                Id="detached-3"
                                Payload="@("Product C - $199")"
                                ClassValue="@(state => TriggerClass(state))">
                    Product C
                </TooltipTrigger>
            </div>

            <TooltipRoot Handle="@detachedHandle">
                <ChildContentWithPayload>
                    @{
                        var handlePayloadContext = context;
                    }
                    <TooltipPortal>
                        <TooltipPositioner SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                @(handlePayloadContext.Payload?.ToString() ?? "Hover a product")
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </ChildContentWithPayload>
            </TooltipRoot>

            <div class="flex gap-2">
                <button class="rounded bg-blue-500 px-3 py-1.5 text-sm text-white hover:bg-blue-600"
                        @onclick="@(() => detachedHandle.Open("detached-1"))">
                    Open Product A
                </button>
                <button class="rounded bg-gray-200 px-3 py-1.5 text-sm hover:bg-gray-300"
                        @onclick="@(() => detachedHandle.Close())">
                    Close
                </button>
            </div>
        </div>
        <div class="mt-3 rounded bg-gray-100 p-3 text-sm text-gray-700">
            <p>Triggers are placed <strong>outside</strong> the TooltipRoot but share a common handle.</p>
            <p class="mt-1">The handle also allows imperative control via <code>Open(triggerId)</code> and <code>Close()</code>.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Typed Payload with Handle"
                 Description="Use generics for type-safe payloads with complex data objects.">
        <div class="flex flex-col gap-4">
            <div class="flex gap-4">
                @foreach (var user in sampleUsers)
                {
                    <TooltipTrigger TPayload="UserInfo"
                                    Handle="@typedHandle"
                                    Id="@($"user-{user.Id}")"
                                    Payload="@user"
                                    ClassValue="@(state => TriggerClass(state))">
                        @user.Name
                    </TooltipTrigger>
                }
            </div>

            <TooltipRoot Handle="@typedHandle">
                <ChildContentWithPayload>
                    @{
                        var typedPayloadContext = context;
                        var userInfo = typedPayloadContext.Payload as UserInfo;
                    }
                    <TooltipPortal>
                        <TooltipPositioner SideOffset="8">
                            <TooltipPopup ClassValue="@(state => PopupClass(state))" StyleValue="@(_ => "min-width: 200px;")">
                                <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                                    @ArrowSvg
                                </TooltipArrow>
                                @if (userInfo is not null)
                                {
                                    <div class="space-y-1">
                                        <p class="font-medium">@userInfo.Name</p>
                                        <p class="text-xs text-gray-600">@userInfo.Email</p>
                                        <p class="text-xs">
                                            <span class="inline-block h-2 w-2 rounded-full @(userInfo.IsOnline ? "bg-green-500" : "bg-gray-400")"></span>
                                            @(userInfo.IsOnline ? "Online" : "Offline")
                                        </p>
                                    </div>
                                }
                                else
                                {
                                    <span>Hover a user</span>
                                }
                            </TooltipPopup>
                        </TooltipPositioner>
                    </TooltipPortal>
                </ChildContentWithPayload>
            </TooltipRoot>
        </div>
        <div class="mt-3 rounded bg-gray-100 p-3 text-sm text-gray-700">
            <p>Using <code>TooltipTrigger&lt;UserInfo&gt;</code> and <code>TooltipHandle&lt;UserInfo&gt;</code> provides compile-time type safety.</p>
        </div>
    </DemoSection>

    <DemoSection Title="Documentation Example"
                 Description="A comprehensive example matching the official base-ui documentation styling.">
        <TooltipRoot>
            <TooltipTrigger TPayload="object" ClassValue="@(state => DocsTriggerClass(state))">
                <span class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                    Layers
                </span>
            </TooltipTrigger>
            <TooltipPortal>
                <TooltipPositioner SideOffset="8">
                    <TooltipPopup ClassValue="@(state => PopupClass(state))">
                        <TooltipArrow ClassValue="@(state => ArrowClass(state))">
                            @ArrowSvg
                        </TooltipArrow>
                        Manage your layers and organization
                    </TooltipPopup>
                </TooltipPositioner>
            </TooltipPortal>
        </TooltipRoot>
    </DemoSection>

</ComponentShowcase>

@code {
    [Parameter]
    public bool IsWasmMode { get; set; }

    private bool controlledOpen;
    private TooltipOpenChangeReason? lastReason;

    // Handle for detached triggers demo (untyped)
    private readonly TooltipHandle<object> detachedHandle = new();

    // Handle for typed payload demo
    private readonly TooltipHandle<UserInfo> typedHandle = new();

    // Sample data for typed payload demo
    private readonly List<UserInfo> sampleUsers =
    [
        new UserInfo(1, "Alice", "alice@example.com", true),
        new UserInfo(2, "Bob", "bob@example.com", false),
        new UserInfo(3, "Charlie", "charlie@example.com", true)
    ];

    private record UserInfo(int Id, string Name, string Email, bool IsOnline);

    private static readonly RenderFragment ArrowSvg = __builder =>
    {
        <svg width="20" height="10" viewBox="0 0 20 10" fill="none">
            <path d="M9.66437 2.60207L4.80758 6.97318C4.07308 7.63423 3.11989 8 2.13172 8H0V10H20V8H18.5349C17.5468 8 16.5936 7.63423 15.8591 6.97318L11.0023 2.60207C10.622 2.2598 10.0447 2.25979 9.66437 2.60207Z" class="fill-[canvas]" />
            <path d="M8.99542 1.85876C9.75604 1.17425 10.9106 1.17422 11.6713 1.85878L16.5281 6.22989C17.0789 6.72568 17.7938 7.00001 18.5349 7.00001L15.89 7L11.0023 2.60207C10.622 2.2598 10.0447 2.2598 9.66436 2.60207L4.77734 7L2.13171 7.00001C2.87284 7.00001 3.58774 6.72568 4.13861 6.22989L8.99542 1.85876Z" class="fill-gray-200 dark:fill-none" />
            <path d="M10.3333 3.34539L5.47654 7.71648C4.55842 8.54279 3.36693 9 2.13172 9H0V8H2.13172C3.11989 8 4.07308 7.63423 4.80758 6.97318L9.66437 2.60207C10.0447 2.25979 10.622 2.2598 11.0023 2.60207L15.8591 6.97318C16.5936 7.63423 17.5468 8 18.5349 8H20V9H18.5349C17.2998 9 16.1083 8.54278 15.1901 7.71648L10.3333 3.34539Z" class="dark:fill-gray-300" />
        </svg>
    };

    private Task HandleOpenChange(TooltipOpenChangeEventArgs e)
    {
        controlledOpen = e.Open;
        lastReason = e.Reason;
        return Task.CompletedTask;
    }

    private static string TriggerClass(TooltipTriggerState state)
    {
        var baseClass = "flex h-10 items-center justify-center gap-2 rounded-md border border-gray-200 bg-gray-50 px-3.5 text-sm font-medium text-gray-900 select-none hover:bg-gray-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-800 active:bg-gray-100";

        if (state.Disabled)
            return $"{baseClass} opacity-50 cursor-not-allowed";

        return state.Open ? $"{baseClass} bg-gray-100" : baseClass;
    }

    private static string PopupClass(TooltipPopupState state)
    {
        var baseClass = "origin-[var(--transform-origin)] rounded-md bg-[canvas] px-3 py-1.5 text-sm text-gray-900 shadow-lg shadow-gray-200 outline outline-1 outline-gray-200";

        if (state.TransitionStatus == Popover.TransitionStatus.Starting)
        {
            return $"{baseClass} opacity-0 scale-90";
        }

        if (state.TransitionStatus == Popover.TransitionStatus.Ending)
        {
            return $"{baseClass} opacity-0 scale-90";
        }

        return $"{baseClass} opacity-100 scale-100 transition-[transform,opacity] duration-200";
    }

    private static string ArrowClass(TooltipArrowState state)
    {
        return "data-[side=bottom]:top-[-10px] data-[side=left]:right-[-10px] data-[side=left]:rotate-90 data-[side=right]:left-[-10px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-10px] data-[side=top]:rotate-180";
    }

    private static string DocsTriggerClass(TooltipTriggerState state)
    {
        var baseClass = "flex h-10 items-center justify-center gap-2 rounded-md border border-gray-200 bg-gray-50 px-3.5 text-sm font-medium text-gray-900 select-none hover:bg-gray-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-800 active:bg-gray-100";
        return state.Open ? $"{baseClass} bg-gray-100" : baseClass;
    }
}
