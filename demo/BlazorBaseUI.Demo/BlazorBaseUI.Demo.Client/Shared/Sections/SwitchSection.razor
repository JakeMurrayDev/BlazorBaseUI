@using BlazorBaseUI.Switch
@using BlazorBaseUI.Field
@using BlazorBaseUI.Form
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<ComponentShowcase ComponentName="Switch"
                   Description="A control that indicates whether a setting is on or off."
                   BaseRoute="/switch"
                   IsWasmMode="IsWasmMode">
    <DemoSection Title="Basic Switch"
                 Description="Uncontrolled switch using DefaultChecked. Click to toggle state.">
        <div class="flex items-center gap-4">
            <SwitchRoot DefaultChecked="false"
                        ClassValue="@(state => SwitchRootClass(state))">
                <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
            </SwitchRoot>
            <span class="text-gray-700">Enable notifications</span>
        </div>
    </DemoSection>

    <DemoSection Title="Controlled Switch"
                 Description="State controlled externally via Checked parameter. Updates when changed from outside.">
        <div class="flex items-center gap-4">
            <SwitchRoot Checked="@controlledChecked"
                        CheckedChanged="@(value => controlledChecked = value)"
                        ClassValue="@(state => SwitchRootClass(state))">
                <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
            </SwitchRoot>
            <span class="text-gray-700">Checked: @(controlledChecked ? "true" : "false")</span>
            <button type="button"
                    class="rounded bg-indigo-600 px-3 py-1 text-sm text-white hover:bg-indigo-700"
                    @onclick="@(() => controlledChecked = !controlledChecked)">
                Toggle Externally
            </button>
        </div>
    </DemoSection>

    <DemoSection Title="Disabled State"
                 Description="Uses aria-disabled instead of HTML disabled. Click has no effect.">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3">
                <SwitchRoot Disabled="true"
                            DefaultChecked="false"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-500">Disabled (off)</span>
            </div>
            <div class="flex items-center gap-3">
                <SwitchRoot Disabled="true"
                            DefaultChecked="true"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-500">Disabled (on)</span>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="ReadOnly State"
                 Description="Sets aria-readonly attribute. Click does not change state but element remains focusable.">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3">
                <SwitchRoot ReadOnly="true"
                            DefaultChecked="false"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-700">ReadOnly (off)</span>
            </div>
            <div class="flex items-center gap-3">
                <SwitchRoot ReadOnly="true"
                            DefaultChecked="true"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-700">ReadOnly (on)</span>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Data Attributes Visualization"
                 Description="Shows all data-* style hooks on Root and Thumb based on component state.">
        <div class="flex flex-col gap-4">
            <div class="flex items-center gap-3">
                <SwitchRoot DefaultChecked="true"
                            Disabled="@dataAttrDisabled"
                            ReadOnly="@dataAttrReadOnly"
                            Required="@dataAttrRequired"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-700">Toggle to see attribute changes</span>
            </div>
            <div class="flex flex-wrap gap-2">
                <label class="flex items-center gap-1 text-sm">
                    <input type="checkbox" @bind="dataAttrDisabled" class="rounded" />
                    <span>Disabled</span>
                </label>
                <label class="flex items-center gap-1 text-sm">
                    <input type="checkbox" @bind="dataAttrReadOnly" class="rounded" />
                    <span>ReadOnly</span>
                </label>
                <label class="flex items-center gap-1 text-sm">
                    <input type="checkbox" @bind="dataAttrRequired" class="rounded" />
                    <span>Required</span>
                </label>
            </div>
            <div class="rounded bg-gray-100 p-3 font-mono text-xs">
                <p>Expected attributes on Root and Thumb:</p>
                <ul class="mt-1 list-inside list-disc">
                    <li>data-checked / data-unchecked (mutually exclusive)</li>
                    @if (dataAttrDisabled)
                    {
                        <li>data-disabled</li>
                    }
                    @if (dataAttrReadOnly)
                    {
                        <li>data-readonly</li>
                    }
                    @if (dataAttrRequired)
                    {
                        <li>data-required</li>
                    }
                </ul>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Native Label Integration"
                 Description="Switch toggles when clicking a wrapping or explicitly linked label.">
        <div class="flex flex-col gap-6">
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">Wrapping label:</p>
                <label class="flex cursor-pointer items-center gap-3">
                    <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <span class="text-gray-700">Click this label to toggle</span>
                </label>
            </div>
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">Explicit htmlFor link:</p>
                <div class="flex items-center gap-3">
                    <SwitchRoot id="explicit-label-switch"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <label for="explicit-label-switch" class="cursor-pointer text-gray-700">
                        Click this separate label
                    </label>
                </div>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="OnCheckedChange Callback"
                 Description="Event handler called when switch is toggled.">
        <div class="flex flex-col gap-4">
            <div class="flex items-center gap-4">
                <SwitchRoot OnCheckedChange="@HandleCheckedChange"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-700">Change count: @changeCount</span>
            </div>
            <div class="flex items-center gap-4">
                <SwitchRoot OnCheckedChange="@HandleCancelableChange"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <label class="flex items-center gap-2">
                    <input type="checkbox" @bind="preventChange" class="rounded" />
                    <span class="text-sm text-gray-700">Cancel next change</span>
                </label>
            </div>
        </div>
    </DemoSection>

    <DemoSection Title="Keyboard Navigation"
                 Description="Focus with Tab, toggle with Space or Enter keys.">
        <div class="flex flex-col gap-4">
            <div class="flex items-center gap-4">
                <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-700">Tab here, then press Space or Enter</span>
            </div>
            <p class="text-sm text-gray-500">
                The switch is focusable and can be toggled using keyboard.
                @if (!IsWasmMode)
                {
                    <span class="text-amber-600"> (Server mode may have slight latency)</span>
                }
            </p>
        </div>
    </DemoSection>

    <DemoSection Title="Form Submission"
                 Description="Switch submits 'on' when checked, nothing when unchecked (matches native checkbox).">
        <Form Model="@(new object())" OnFormSubmit="@HandleBasicFormSubmit">
            <FieldRoot Name="newsletter">
                <div class="flex items-center gap-3">
                    <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        Subscribe to newsletter
                    </FieldLabel>
                </div>
            </FieldRoot>
            <button type="submit"
                    class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
                Submit
            </button>
        </Form>
        @if (basicFormResult is not null)
        {
            <div class="mt-4 rounded bg-gray-100 p-3 text-sm">
                <strong>Submitted value:</strong> @basicFormResult
            </div>
        }
    </DemoSection>

    <DemoSection Title="UncheckedValue Submission"
                 Description="Custom value submitted when switch is off.">
        <Form Model="@(new object())" OnFormSubmit="@HandleUncheckedValueFormSubmit">
            <FieldRoot Name="marketing">
                <div class="flex items-center gap-3">
                    <SwitchRoot UncheckedValue="false"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        Marketing emails (submits "on" or "false")
                    </FieldLabel>
                </div>
            </FieldRoot>
            <button type="submit"
                    class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
                Submit
            </button>
        </Form>
        @if (uncheckedValueResult is not null)
        {
            <div class="mt-4 rounded bg-gray-100 p-3 text-sm">
                <strong>Submitted value:</strong> @uncheckedValueResult
            </div>
        }
    </DemoSection>

    <DemoSection Title="Custom Value Submission"
                 Description="Uses Value parameter to submit a custom value instead of default 'on'.">
        <Form Model="@(new object())" OnFormSubmit="@HandleCustomValueFormSubmit">
            <FieldRoot Name="preference">
                <div class="flex items-center gap-3">
                    <SwitchRoot Value="enabled"
                                UncheckedValue="disabled"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        Feature toggle (submits "enabled" or "disabled")
                    </FieldLabel>
                </div>
            </FieldRoot>
            <button type="submit"
                    class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
                Submit
            </button>
        </Form>
        @if (customValueResult is not null)
        {
            <div class="mt-4 rounded bg-gray-100 p-3 text-sm">
                <strong>Submitted value:</strong> @customValueResult
            </div>
        }
    </DemoSection>

    <DemoSection Title="Native Button Mode"
                 Description="Renders as native button element with built-in keyboard support (Space/Enter).">
        <div class="flex flex-col gap-6">
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">Native button (renders as &lt;button type=&quot;button&quot;&gt;):</p>
                <div class="flex items-center gap-3">
                    <SwitchRoot NativeButton="true"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <span class="text-gray-700">Native keyboard handling via button element</span>
                </div>
            </div>
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">Disabled native button:</p>
                <div class="flex items-center gap-3">
                    <SwitchRoot NativeButton="true"
                                Disabled="true"
                                DefaultChecked="true"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <span class="text-gray-500">Uses native disabled attribute</span>
                </div>
            </div>
        </div>
        <p class="mt-4 text-sm text-gray-500">
            The native button mode uses the browser's built-in keyboard handling for Space and Enter keys,
            rather than JavaScript event handlers.
        </p>
    </DemoSection>

    <DemoSection Title="InputElement Access"
                 Description="Programmatic access to the hidden input element via InputElement property.">
        <div class="flex flex-col gap-4">
            <div class="flex items-center gap-3">
                <SwitchRoot @ref="inputElementRef"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <span class="text-gray-700">Switch with accessible InputElement</span>
            </div>
            <button type="button"
                    class="w-fit rounded bg-indigo-600 px-3 py-1 text-sm text-white hover:bg-indigo-700"
                    @onclick="@ToggleViaInputElement">
                Toggle via InputElement.click()
            </button>
            <p class="text-sm text-gray-500">
                The InputElement property exposes the hidden checkbox for programmatic access.
            </p>
        </div>
    </DemoSection>

    <DemoSection Title="Required Validation"
                 Description="Triggers native HTML validation on form submit.">
        <Form Model="@(new object())">
            <FieldRoot Name="terms">
                <div class="flex items-center gap-3">
                    <SwitchRoot Required="true"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        I accept the terms and conditions *
                    </FieldLabel>
                </div>
                <FieldError Match="true"
                            MatchValidity="valueMissing"
                            ClassValue="@(_ => "text-red-600 text-sm mt-2")">
                    You must accept the terms to continue.
                </FieldError>
            </FieldRoot>
            <button type="submit"
                    class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
                Submit
            </button>
        </Form>
    </DemoSection>

    <DemoSection Title="Field Integration: Disabled"
                 Description="Switch receives disabled state from Field.Root.">
        <FieldRoot Disabled="true">
            <div class="flex items-center gap-3">
                <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <FieldLabel ClassValue="@(_ => "text-gray-500 cursor-not-allowed")">
                    Disabled via Field.Root
                </FieldLabel>
            </div>
        </FieldRoot>
    </DemoSection>

    <DemoSection Title="Field Integration: Name"
                 Description="Switch receives name attribute from Field.Root for form submission.">
        <Form Model="@(new object())" OnFormSubmit="@HandleFieldNameFormSubmit">
            <FieldRoot Name="field-switch">
                <div class="flex items-center gap-3">
                    <SwitchRoot DefaultChecked="true"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        Name inherited from Field.Root
                    </FieldLabel>
                </div>
            </FieldRoot>
            <button type="submit"
                    class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
                Submit
            </button>
        </Form>
        @if (fieldNameResult is not null)
        {
            <div class="mt-4 rounded bg-gray-100 p-3 text-sm">
                <strong>Submitted:</strong> @fieldNameResult
            </div>
        }
    </DemoSection>

    <DemoSection Title="Field Integration: Description"
                 Description="Switch receives aria-describedby from Field.Description.">
        <FieldRoot Name="with-description">
            <div class="flex items-center gap-3">
                <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                    Enable dark mode
                </FieldLabel>
            </div>
            <FieldDescription ClassValue="@(_ => "text-sm text-gray-500 mt-1")">
                Switch to dark mode for a more comfortable viewing experience at night.
            </FieldDescription>
        </FieldRoot>
    </DemoSection>

    <DemoSection Title="Field State Tracking"
                 Description="Tracks touched (on blur), dirty (value changed), filled (checked), and focused states.">
        <FieldRoot Name="tracking">
            <div class="flex items-center gap-3">
                <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                    Focus, blur, and toggle to see state changes
                </FieldLabel>
            </div>
            <FieldStateDisplay Context="fieldState">
                <div class="mt-3 flex gap-4 text-xs">
                    <StateIndicator Label="Touched" IsActive="@fieldState.Touched" />
                    <StateIndicator Label="Dirty" IsActive="@fieldState.Dirty" />
                    <StateIndicator Label="Filled" IsActive="@fieldState.Filled" />
                    <StateIndicator Label="Focused" IsActive="@fieldState.Focused" />
                </div>
            </FieldStateDisplay>
        </FieldRoot>
    </DemoSection>

    <DemoSection Title="Field State: data-filled"
                 Description="Adds data-filled when checked after being initially unchecked. Removes when unchecked.">
        <FieldRoot Name="filled-demo">
            <div class="flex items-center gap-3">
                <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                    Toggle to see data-filled change
                </FieldLabel>
            </div>
            <FieldStateDisplay Context="fieldState">
                <div class="mt-2 rounded bg-gray-100 p-2 font-mono text-xs">
                    data-filled: @(fieldState.Filled ? "present" : "absent")
                </div>
            </FieldStateDisplay>
        </FieldRoot>
    </DemoSection>

    <DemoSection Title="Initially Checked: data-filled"
                 Description="Removes data-filled when unchecked after being initially checked.">
        <FieldRoot Name="initially-checked">
            <div class="flex items-center gap-3">
                <SwitchRoot DefaultChecked="true"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                    Initially checked - toggle to remove data-filled
                </FieldLabel>
            </div>
            <FieldStateDisplay Context="fieldState">
                <div class="mt-2 rounded bg-gray-100 p-2 font-mono text-xs">
                    data-filled: @(fieldState.Filled ? "present" : "absent")
                </div>
            </FieldStateDisplay>
        </FieldRoot>
    </DemoSection>

    <DemoSection Title="Validation Mode: onChange"
                 Description="Validates immediately when value changes.">
        <FieldRoot Name="onChange-validation"
                   ValidationMode="ValidationMode.OnChange"
                   Validate="@ValidateMustBeChecked">
            <div class="flex items-center gap-3">
                <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                    Must be on (validates on change)
                </FieldLabel>
            </div>
            <FieldError ClassValue="@(_ => "text-red-600 text-sm mt-2")" />
        </FieldRoot>
    </DemoSection>

    <DemoSection Title="Validation Mode: onBlur"
                 Description="Validates when switch loses focus.">
        <FieldRoot Name="onBlur-validation"
                   ValidationMode="ValidationMode.OnBlur">
            <div class="flex items-center gap-3">
                <SwitchRoot Required="true"
                            ClassValue="@(state => SwitchRootClass(state))">
                    <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                </SwitchRoot>
                <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                    Required (validates on blur)
                </FieldLabel>
            </div>
            <FieldError Match="true"
                        MatchValidity="valueMissing"
                        ClassValue="@(_ => "text-red-600 text-sm mt-2")">
                This field is required.
            </FieldError>
        </FieldRoot>
        <p class="mt-2 text-sm text-gray-500">
            Focus the switch, then blur to trigger validation.
        </p>
    </DemoSection>

    <DemoSection Title="Validation Mode: onSubmit with revalidation"
                 Description="Validates on submit, then revalidates on change after first error.">
        <Form Model="@(new object())">
            <FieldRoot Name="submit-revalidate">
                <div class="flex items-center gap-3">
                    <SwitchRoot Required="true"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        Required switch
                    </FieldLabel>
                </div>
                <FieldError ClassValue="@(_ => "text-red-600 text-sm mt-2")" />
            </FieldRoot>
            <button type="submit"
                    class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
                Submit
            </button>
        </Form>
        <p class="mt-2 text-sm text-gray-500">
            Submit without enabling to see error. Enable to clear, disable to see it reappear.
        </p>
    </DemoSection>

    <DemoSection Title="External Errors"
                 Description="Errors set via Form.Errors prop. Cleared on value change.">
        <Form Model="@(new object())" Errors="@externalErrors">
            <FieldRoot Name="external">
                <div class="flex items-center gap-3">
                    <SwitchRoot ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        Has external error (toggle to clear)
                    </FieldLabel>
                </div>
                <FieldError ClassValue="@(_ => "text-red-600 text-sm mt-2")" />
            </FieldRoot>
        </Form>
        <button type="button"
                class="mt-3 rounded bg-red-600 px-3 py-1 text-sm text-white hover:bg-red-700"
                @onclick="@SetExternalError">
            Set External Error
        </button>
    </DemoSection>

    <DemoSection Title="Name Only on Hidden Input"
                 Description="The name attribute is set only on the hidden input, not the switch element.">
        <Form Model="@(new object())" OnFormSubmit="@HandleNameOnInputFormSubmit">
            <FieldRoot Name="name-test">
                <div class="flex items-center gap-3">
                    <SwitchRoot Name="switch-name"
                                DefaultChecked="true"
                                ClassValue="@(state => SwitchRootClass(state))">
                        <SwitchThumb ClassValue="@(state => SwitchThumbClass(state))" />
                    </SwitchRoot>
                    <FieldLabel ClassValue="@(_ => "text-gray-700 cursor-pointer")">
                        Name="switch-name" (only on hidden input)
                    </FieldLabel>
                </div>
            </FieldRoot>
            <button type="submit"
                    class="mt-4 rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700">
                Submit
            </button>
        </Form>
        @if (nameOnInputResult is not null)
        {
            <div class="mt-4 rounded bg-gray-100 p-3 text-sm">
                <strong>Submitted:</strong> @nameOnInputResult
            </div>
        }
    </DemoSection>
</ComponentShowcase>

@implements IAsyncDisposable

@code {
    [Parameter]
    public bool IsWasmMode { get; set; }

    private Lazy<Task<IJSObjectReference>> moduleTask = null!;

    private bool controlledChecked;
    private int changeCount;
    private bool preventChange;

    private bool dataAttrDisabled;
    private bool dataAttrReadOnly;
    private bool dataAttrRequired;

    private string? basicFormResult;
    private string? uncheckedValueResult;
    private string? customValueResult;
    private string? fieldNameResult;
    private string? nameOnInputResult;
    private SwitchRoot? inputElementRef;

    private Dictionary<string, string[]> externalErrors = new();

    protected override void OnInitialized()
    {
        moduleTask = new Lazy<Task<IJSObjectReference>>(() =>
            JSRuntime.InvokeAsync<IJSObjectReference>("import", "./demo-utilities.js").AsTask());
    }

    private void HandleCheckedChange(SwitchCheckedChangeEventArgs e)
    {
        changeCount++;
    }

    private void HandleCancelableChange(SwitchCheckedChangeEventArgs e)
    {
        if (preventChange)
        {
            e.Cancel();
            preventChange = false;
        }
    }

    private void HandleBasicFormSubmit(FormSubmitEventArgs e)
    {
        basicFormResult = e.Values.TryGetValue("newsletter", out var value) ? value?.ToString() : "(not submitted)";
    }

    private void HandleUncheckedValueFormSubmit(FormSubmitEventArgs e)
    {
        uncheckedValueResult = e.Values.TryGetValue("marketing", out var value) ? value?.ToString() : "(not submitted)";
    }

    private void HandleCustomValueFormSubmit(FormSubmitEventArgs e)
    {
        customValueResult = e.Values.TryGetValue("preference", out var value) ? value?.ToString() : "(not submitted)";
    }

    private async Task ToggleViaInputElement()
    {
        if (inputElementRef is not null)
        {
            var module = await moduleTask.Value;
            await module.InvokeVoidAsync("clickElement", inputElementRef.InputElement);
        }
    }

    private void HandleFieldNameFormSubmit(FormSubmitEventArgs e)
    {
        fieldNameResult = string.Join(", ", e.Values.Select(kv => $"{kv.Key}: {kv.Value}"));
    }

    private void HandleNameOnInputFormSubmit(FormSubmitEventArgs e)
    {
        nameOnInputResult = string.Join(", ", e.Values.Select(kv => $"{kv.Key}: {kv.Value}"));
    }

    private Task<string[]?> ValidateMustBeChecked(object? value)
    {
        var isChecked = value is true;
        return Task.FromResult<string[]?>(isChecked ? null : ["This switch must be on"]);
    }

    private void SetExternalError()
    {
        externalErrors = new Dictionary<string, string[]>
        {
            ["external"] = ["This is an external server error"]
        };
    }

    private static string SwitchRootClass(SwitchRootState state)
    {
        var baseClass = "relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 focus-visible:ring-offset-2";

        if (state.Disabled)
            return $"{baseClass} opacity-50 cursor-not-allowed {(state.Checked ? "bg-indigo-600" : "bg-gray-200")}";

        if (state.Valid == false)
            return $"{baseClass} ring-2 ring-red-500 {(state.Checked ? "bg-indigo-600" : "bg-gray-200")}";

        if (state.Checked)
            return $"{baseClass} bg-indigo-600";

        return $"{baseClass} bg-gray-200";
    }

    private static string SwitchThumbClass(SwitchRootState state)
    {
        var baseClass = "pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out";

        if (state.Checked)
            return $"{baseClass} translate-x-5";

        return $"{baseClass} translate-x-0";
    }

    public async ValueTask DisposeAsync()
    {
        if (moduleTask.IsValueCreated)
        {
            try
            {
                var module = await moduleTask.Value;
                await module.DisposeAsync();
            }
            catch (Exception ex) when (ex is JSDisconnectedException or TaskCanceledException)
            {
            }
        }
    }
}