<CascadingValue Value="context" IsFixed="true">
    @ChildContent
</CascadingValue>

@code {
    private DateTime? lastClosedTime;
    private TooltipProviderContext context = null!;

    /// <summary>
    /// Gets or sets the delay in milliseconds before the tooltip opens on hover.
    /// When <see langword="null"/>, falls back to the trigger's default delay.
    /// </summary>
    [Parameter]
    public int? Delay { get; set; }

    /// <summary>
    /// Gets or sets the delay in milliseconds before the tooltip closes after the cursor leaves.
    /// When <see langword="null"/>, falls back to the trigger's default close delay.
    /// </summary>
    [Parameter]
    public int? CloseDelay { get; set; }

    /// <summary>
    /// Gets or sets the timeout in milliseconds for the instant phase.
    /// During this window after closing one tooltip, another tooltip opens instantly.
    /// Defaults to <c>400</c>.
    /// </summary>
    [Parameter]
    public int Timeout { get; set; } = 400;

    /// <summary>
    /// Defines the child components of this instance.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <inheritdoc />
    protected override void OnInitialized()
    {
        context = new TooltipProviderContext
        {
            Delay = Delay,
            CloseDelay = CloseDelay,
            Timeout = Timeout,
            GetLastClosedTime = () => lastClosedTime,
            SetLastClosedTime = SetLastClosedTime
        };
    }

    /// <inheritdoc />
    protected override void OnParametersSet()
    {
        context.Delay = Delay;
        context.CloseDelay = CloseDelay;
        context.Timeout = Timeout;
    }

    private void SetLastClosedTime()
    {
        lastClosedTime = DateTime.UtcNow;
    }
}
