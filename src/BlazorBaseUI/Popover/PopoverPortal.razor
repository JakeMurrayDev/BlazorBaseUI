@if (RootContext is not null && (RootContext.GetMounted() || KeepMounted))
{
    <CascadingValue Value="portalContext" IsFixed="true">
        <BlazorBaseUI.Portal.Portal Target="@Container">
            @ChildContent
        </BlazorBaseUI.Portal.Portal>
    </CascadingValue>
}

@code {
    private PopoverPortalContext portalContext = null!;

    [CascadingParameter]
    private PopoverRootContext? RootContext { get; set; }

    /// <summary>
    /// Determines whether the portal is kept mounted in the DOM while the popup is hidden.
    /// Defaults to <see langword="false"/>.
    /// </summary>
    [Parameter]
    public bool KeepMounted { get; set; }

    /// <summary>
    /// Gets or sets the CSS selector of the container element to portal the popup to.
    /// Defaults to <c>"body"</c>.
    /// </summary>
    [Parameter]
    public string Container { get; set; } = "body";

    /// <summary>
    /// Defines the child components of this instance.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <inheritdoc />
    protected override void OnInitialized()
    {
        portalContext = new PopoverPortalContext { KeepMounted = KeepMounted };
    }

    /// <inheritdoc />
    protected override void OnParametersSet()
    {
        portalContext.KeepMounted = KeepMounted;
    }
}
