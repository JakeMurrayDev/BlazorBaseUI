@using BlazorBaseUI.Portal

@if (Context is not null && (KeepMounted || Context.Mounted))
{
    <CascadingValue TValue="DialogPortalContext" Value="portalContext" IsFixed="true">
        <Portal Target="@Container">
            @ChildContent
        </Portal>
    </CascadingValue>
}

@code {
    private DialogPortalContext portalContext = null!;

    [CascadingParameter]
    private DialogRootContext? Context { get; set; }

    /// <summary>
    /// Determines whether the portal contents should remain mounted in the DOM when the dialog is closed.
    /// Defaults to <see langword="false"/>.
    /// </summary>
    [Parameter]
    public bool KeepMounted { get; set; }

    /// <summary>
    /// Gets or sets a CSS selector for the container to render the portal into.
    /// Defaults to <c>"body"</c>.
    /// </summary>
    [Parameter]
    public string Container { get; set; } = "body";

    /// <summary>
    /// Defines the child components of this instance.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <inheritdoc />
    protected override void OnInitialized()
    {
        if (Context is null)
        {
            throw new InvalidOperationException("DialogPortal must be used within a DialogRoot.");
        }

        portalContext = new DialogPortalContext { KeepMounted = KeepMounted };
    }

    /// <inheritdoc />
    protected override void OnParametersSet()
    {
        if (portalContext is not null)
        {
            portalContext.KeepMounted = KeepMounted;
        }
    }
}
