@using BlazorBaseUI.Portal

@if (RootContext is not null && (RootContext.GetMounted() || KeepMounted))
{
    <CascadingValue TValue="MenuPortalContext" Value="portalContext" IsFixed="true">
        <Portal Target="@Container">
            @ChildContent
        </Portal>
    </CascadingValue>
}

@code {
    private MenuPortalContext portalContext = null!;

    [CascadingParameter]
    private MenuRootContext? RootContext { get; set; }

    /// <summary>
    /// Determines whether the portal contents should remain mounted in the DOM when the menu is closed.
    /// Defaults to <see langword="false"/>.
    /// </summary>
    [Parameter]
    public bool KeepMounted { get; set; }

    /// <summary>
    /// Gets or sets a CSS selector for the container to render the portal into.
    /// </summary>
    [Parameter]
    public string Container { get; set; } = "body";

    /// <summary>
    /// Defines the child components of this instance.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <inheritdoc />
    protected override void OnInitialized()
    {
        portalContext = new MenuPortalContext { KeepMounted = KeepMounted };
    }

    /// <inheritdoc />
    protected override void OnParametersSet()
    {
        if (portalContext.KeepMounted != KeepMounted)
        {
            portalContext.KeepMounted = KeepMounted;
        }
    }
}
