@page "/tests/toolbar/server"
@using BlazorBaseUI.Toolbar
@rendermode @(new InteractiveServerRenderMode(prerender: false))

<PageTitle>Toolbar Test Page (Server)</PageTitle>

<div data-testid="test-container" data-interactive="@RendererInfo.IsInteractive.ToString().ToLowerInvariant()">
    <button data-testid="before-button" type="button" style="margin-bottom: 10px;">Before Button</button>

    <ToolbarRoot
        Disabled="@IsDisabled"
        Orientation="@ResolvedOrientation"
        LoopFocus="@IsLoopFocus"
        data-testid="toolbar"
        aria-label="Toolbar">

        <ToolbarButton data-testid="toolbar-button-1">Button 1</ToolbarButton>

        @if (IsShowGroup)
        {
            <ToolbarGroup Disabled="@IsGroupDisabled" data-testid="toolbar-group">
                <ToolbarButton data-testid="toolbar-group-button-1">Group Button 1</ToolbarButton>
                <ToolbarButton data-testid="toolbar-group-button-2">Group Button 2</ToolbarButton>
            </ToolbarGroup>
        }

        <ToolbarButton Disabled="@IsButton2Disabled" FocusableWhenDisabled="@IsFocusableWhenDisabled" data-testid="toolbar-button-2">Button 2</ToolbarButton>

        @if (IsShowSeparator)
        {
            <ToolbarSeparator data-testid="toolbar-separator" />
        }

        <ToolbarButton data-testid="toolbar-button-3">Button 3</ToolbarButton>

        @if (IsShowLink)
        {
            <ToolbarLink href="#" data-testid="toolbar-link">Link</ToolbarLink>
        }

        @if (IsShowInput)
        {
            <ToolbarInput placeholder="Search..." data-testid="toolbar-input" />
        }
    </ToolbarRoot>

    <button data-testid="after-button" type="button" style="margin-top: 10px;">After Button</button>

    <div style="margin-top: 20px;">
        <button data-testid="toggle-disabled" type="button" @onclick="ToggleDisabled">Toggle Disabled</button>
        <button data-testid="toggle-orientation" type="button" @onclick="ToggleOrientation">Toggle Orientation</button>
    </div>
</div>

@code {
    [SupplyParameterFromQuery(Name = "disabled")]
    public bool? QueryDisabled { get; set; }

    [SupplyParameterFromQuery(Name = "orientation")]
    public string? QueryOrientation { get; set; }

    [SupplyParameterFromQuery(Name = "loopFocus")]
    public bool? QueryLoopFocus { get; set; }

    [SupplyParameterFromQuery(Name = "showGroup")]
    public bool? QueryShowGroup { get; set; }

    [SupplyParameterFromQuery(Name = "showLink")]
    public bool? QueryShowLink { get; set; }

    [SupplyParameterFromQuery(Name = "showInput")]
    public bool? QueryShowInput { get; set; }

    [SupplyParameterFromQuery(Name = "showSeparator")]
    public bool? QueryShowSeparator { get; set; }

    [SupplyParameterFromQuery(Name = "groupDisabled")]
    public bool? QueryGroupDisabled { get; set; }

    [SupplyParameterFromQuery(Name = "button2Disabled")]
    public bool? QueryButton2Disabled { get; set; }

    [SupplyParameterFromQuery(Name = "focusableWhenDisabled")]
    public bool? QueryFocusableWhenDisabled { get; set; }

    private bool IsDisabled { get; set; }
    private bool IsShowGroup => QueryShowGroup ?? false;
    private bool IsLoopFocus => QueryLoopFocus ?? true;
    private bool IsShowLink => QueryShowLink ?? false;
    private bool IsShowInput => QueryShowInput ?? false;
    private bool IsShowSeparator => QueryShowSeparator ?? false;
    private bool IsGroupDisabled => QueryGroupDisabled ?? false;
    private bool IsButton2Disabled => QueryButton2Disabled ?? false;
    private bool IsFocusableWhenDisabled => QueryFocusableWhenDisabled ?? true;

    private Orientation ResolvedOrientation { get; set; }

    protected override void OnInitialized()
    {
        IsDisabled = QueryDisabled ?? false;
        ResolvedOrientation = QueryOrientation?.ToLowerInvariant() == "vertical"
            ? Orientation.Vertical
            : Orientation.Horizontal;
    }

    private void ToggleDisabled()
    {
        IsDisabled = !IsDisabled;
    }

    private void ToggleOrientation()
    {
        ResolvedOrientation = ResolvedOrientation == Orientation.Horizontal
            ? Orientation.Vertical
            : Orientation.Horizontal;
    }
}
