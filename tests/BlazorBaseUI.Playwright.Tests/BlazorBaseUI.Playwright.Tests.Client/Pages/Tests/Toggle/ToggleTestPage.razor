@page "/tests/toggle/wasm"
@using BlazorBaseUI.Toggle
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))

<PageTitle>Toggle Test Page (WASM)</PageTitle>

<div data-testid="test-container" data-interactive="@RendererInfo.IsInteractive.ToString().ToLowerInvariant()">
    <button data-testid="before-button" type="button">Before</button>

    <Toggle
        Pressed="@controlledPressed"
        DefaultPressed="@IsDefaultPressed"
        Disabled="@IsDisabled"
        NativeButton="@IsNativeButton"
        OnPressedChange="HandlePressedChange"
        PressedChanged="HandlePressedChanged"
        data-testid="toggle-under-test">
        Toggle
    </Toggle>

    <button data-testid="after-button" type="button">After</button>

    <div data-testid="state-display" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
        <div>Pressed: <span data-testid="pressed-state">@currentPressedDisplay</span></div>
        <div>Change Count: <span data-testid="change-count">@changeCount</span></div>
        <div>Last Pressed Value: <span data-testid="last-pressed-value">@lastPressedValue</span></div>
    </div>

    <div style="margin-top: 10px;">
        <button data-testid="toggle-disabled" type="button" @onclick="ToggleDisabled">Toggle Disabled</button>
        <button data-testid="set-pressed-true" type="button" @onclick="() => SetControlledPressed(true)">Set Pressed True</button>
        <button data-testid="set-pressed-false" type="button" @onclick="() => SetControlledPressed(false)">Set Pressed False</button>
    </div>
</div>

@code {
    [SupplyParameterFromQuery(Name = "disabled")]
    public bool? QueryDisabled { get; set; }

    [SupplyParameterFromQuery(Name = "nativeButton")]
    public bool? QueryNativeButton { get; set; }

    [SupplyParameterFromQuery(Name = "defaultPressed")]
    public bool? QueryDefaultPressed { get; set; }

    private bool IsDisabled { get; set; }
    private bool IsNativeButton => QueryNativeButton ?? true;
    private bool IsDefaultPressed => QueryDefaultPressed ?? false;

    private bool? controlledPressed;
    private int changeCount;
    private string lastPressedValue = "";
    private string currentPressedDisplay = "";

    protected override void OnInitialized()
    {
        IsDisabled = QueryDisabled ?? false;
    }

    private void HandlePressedChange(TogglePressedChangeEventArgs args)
    {
        changeCount++;
        lastPressedValue = args.Pressed.ToString().ToLowerInvariant();
        currentPressedDisplay = args.Pressed.ToString().ToLowerInvariant();
    }

    private void HandlePressedChanged(bool pressed)
    {
        currentPressedDisplay = pressed.ToString().ToLowerInvariant();
        if (controlledPressed.HasValue)
        {
            controlledPressed = pressed;
        }
    }

    private void ToggleDisabled()
    {
        IsDisabled = !IsDisabled;
    }

    private void SetControlledPressed(bool value)
    {
        controlledPressed = value;
        currentPressedDisplay = value.ToString().ToLowerInvariant();
    }
}
