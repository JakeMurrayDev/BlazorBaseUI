@page "/tests/button/wasm"
@using BlazorBaseUI.Button
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))

<PageTitle>Button Test Page (WASM)</PageTitle>

<style>
    .test-button {
        padding: 8px 16px;
        margin: 4px;
        cursor: pointer;
    }
</style>

<div data-testid="test-container" data-interactive="@RendererInfo.IsInteractive.ToString().ToLowerInvariant()">
    @* Focus target before the button under test *@
    <button data-testid="before-button" type="button">Before</button>

    <Button
        Disabled="@IsDisabled"
        FocusableWhenDisabled="@IsFocusableWhenDisabled"
        NativeButton="@IsNativeButton"
        TabIndex="@ResolvedTabIndex"
        As="@ResolvedAs"
        class="test-button"
        data-testid="button-under-test"
        @onclick="OnClick"
        @onfocus="OnFocus"
        @onblur="OnBlur">
        Test Button
    </Button>

    @* Focus target after the button under test *@
    <button data-testid="after-button" type="button">After</button>

    <div data-testid="state-display" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
        <div>Click count: <span data-testid="click-count">@clickCount</span></div>
        <div>Focus count: <span data-testid="focus-count">@focusCount</span></div>
        <div>Blur count: <span data-testid="blur-count">@blurCount</span></div>
        <div>Disabled: <span data-testid="disabled-state">@IsDisabled</span></div>
    </div>

    <div style="margin-top: 10px;">
        <button data-testid="toggle-disabled" type="button" @onclick="ToggleDisabled">Toggle Disabled</button>
        <button data-testid="reset-counters" type="button" @onclick="ResetCounters">Reset Counters</button>
    </div>
</div>

@code {
    [SupplyParameterFromQuery(Name = "disabled")]
    public bool? QueryDisabled { get; set; }

    [SupplyParameterFromQuery(Name = "buttonFocusableWhenDisabled")]
    public bool? QueryFocusableWhenDisabled { get; set; }

    [SupplyParameterFromQuery(Name = "nativeButton")]
    public bool? QueryNativeButton { get; set; }

    [SupplyParameterFromQuery(Name = "buttonTabIndex")]
    public int? QueryTabIndex { get; set; }

    [SupplyParameterFromQuery(Name = "as")]
    public string? QueryAs { get; set; }

    private bool IsDisabled { get; set; }
    private bool IsFocusableWhenDisabled => QueryFocusableWhenDisabled ?? false;
    private bool IsNativeButton => QueryNativeButton ?? true;
    private int ResolvedTabIndex => QueryTabIndex ?? 0;
    private string? ResolvedAs => QueryAs;

    private int clickCount;
    private int focusCount;
    private int blurCount;

    protected override void OnInitialized()
    {
        IsDisabled = QueryDisabled ?? false;
    }

    private void OnClick() => clickCount++;
    private void OnFocus() => focusCount++;
    private void OnBlur() => blurCount++;

    private void ToggleDisabled()
    {
        IsDisabled = !IsDisabled;
    }

    private void ResetCounters()
    {
        clickCount = 0;
        focusCount = 0;
        blurCount = 0;
    }
}
