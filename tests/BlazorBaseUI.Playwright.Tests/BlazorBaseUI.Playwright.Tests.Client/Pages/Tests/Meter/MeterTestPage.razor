@page "/tests/meter/wasm"
@using BlazorBaseUI.Meter
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))

<PageTitle>Meter Test Page (WASM)</PageTitle>

<style>
    .meter-root {
        width: 300px;
        height: 20px;
        position: relative;
    }
    .meter-track {
        width: 100%;
        height: 100%;
        background-color: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
    }
    .meter-indicator {
        background-color: #4caf50;
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    .meter-value {
        font-size: 14px;
    }
    .meter-label {
        font-size: 14px;
        font-weight: bold;
    }
</style>

<div data-testid="test-container" data-interactive="@RendererInfo.IsInteractive.ToString().ToLowerInvariant()">
    <MeterRoot
        Value="@CurrentValue"
        Min="@Min"
        Max="@Max"
        Format="@Format"
        FormatProvider="@ResolvedFormatProvider"
        class="meter-root"
        data-testid="meter-root">

        @if (ShowLabel)
        {
            <MeterLabel class="meter-label" data-testid="meter-label">
                @ResolvedLabelText
            </MeterLabel>
        }

        @if (ShowValue)
        {
            <MeterValue class="meter-value" data-testid="meter-value" />
        }

        <MeterTrack class="meter-track" data-testid="meter-track">
            <MeterIndicator class="meter-indicator" data-testid="meter-indicator" />
        </MeterTrack>
    </MeterRoot>

    <div data-testid="state-display" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
        <div>Value: <span data-testid="current-value">@CurrentValue</span></div>
        <div>Min: <span data-testid="current-min">@Min</span></div>
        <div>Max: <span data-testid="current-max">@Max</span></div>
    </div>

    <div style="margin-top: 10px;">
        <button data-testid="set-value-25" @onclick="() => SetValue(25)">Set 25%</button>
        <button data-testid="set-value-50" @onclick="() => SetValue(50)">Set 50%</button>
        <button data-testid="set-value-100" @onclick="() => SetValue(100)">Set 100%</button>
        <button data-testid="set-value-0" @onclick="() => SetValue(0)">Set 0%</button>
    </div>
</div>

@code {
    [SupplyParameterFromQuery(Name = "value")]
    public double? InitialValue { get; set; }

    [SupplyParameterFromQuery(Name = "min")]
    public double? QueryMin { get; set; }

    [SupplyParameterFromQuery(Name = "max")]
    public double? QueryMax { get; set; }

    [SupplyParameterFromQuery(Name = "format")]
    public string? Format { get; set; }

    [SupplyParameterFromQuery(Name = "locale")]
    public string? Locale { get; set; }

    [SupplyParameterFromQuery(Name = "showLabel")]
    public bool? QueryShowLabel { get; set; }

    [SupplyParameterFromQuery(Name = "showValue")]
    public bool? QueryShowValue { get; set; }

    [SupplyParameterFromQuery(Name = "labelText")]
    public string? LabelText { get; set; }

    private double Min => QueryMin ?? 0;
    private double Max => QueryMax ?? 100;
    private bool ShowLabel => QueryShowLabel ?? true;
    private bool ShowValue => QueryShowValue ?? true;
    private double CurrentValue { get; set; }

    private string ResolvedLabelText => LabelText ?? "Meter";

    private IFormatProvider? ResolvedFormatProvider =>
        !string.IsNullOrEmpty(Locale)
            ? System.Globalization.CultureInfo.GetCultureInfo(Locale)
            : null;

    protected override void OnInitialized()
    {
        CurrentValue = InitialValue ?? 50;
    }

    private void SetValue(double value)
    {
        CurrentValue = value;
    }
}
